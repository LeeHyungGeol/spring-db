# 6. ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ  - QueryDSL<br/>## ëª©ì°¨- QueryDSL ì´ë€?- QueryDSL ì„¤ì •# ğŸ’¡QueryDsl ì´ë€?Querydslì€ ì •ì  íƒ€ì…ì„ ì´ìš©í•´ì„œ SQLê³¼ ê°™ì€ ì¿¼ë¦¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì…ë‹ˆë‹¤.  Querydslì€ ì¿¼ë¦¬ë¥¼ type-safeí•˜ê²Œ ê°œë°œí•  ìˆ˜ ìˆê²Œ ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì£¼ë¡œ JPA Query ( JPQL )ì—ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.DSLì€ Domain Specific Languageë¡œ íŠ¹ì •í•œ í† ë©”ì¸ì— ì´ˆì ì„ ë§ì¶˜ ì œí•œì ì¸ í‘œí˜„ë ¥ì„ ê°€ì§„ ì»´í“¨í„° í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¡œ ë‹¨ìˆœí•˜ê³ , ê°„ê²°í•©ë‹ˆë‹¤.ì´ DSLì„ ì¿¼ë¦¬ì— ì ìš©ì‹œì¼œ ì¿¼ë¦¬ì— íŠ¹í™”ëœ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¡œ ì œê³µí•œ ê²ƒì´ QueryDSLì…ë‹ˆë‹¤.ê¸°ì¡´ ë°©ì‹ì—ëŠ” ì–´ë–¤ ë¬¸ì œê°€ ìˆì—ˆì„ê¹Œ?<br/>## âš¡ï¸ ê¸°ì¡´ ë°©ì‹ì˜ ë¬¸ì œì Queryë¥¼ ì§ì ‘ ì‘ì„±í•´ì•¼ í•˜ëŠ” SQL Mapper ë°©ì‹ì´ë‚˜ JPAì—ì„œ JPQLì„ ì‚¬ìš©í•´ Queryê°€ ì˜ëª» ì‘ì„±ë˜ëŠ” ê²½ìš°,  **ì»´íŒŒì¼ ì‹œì ì—ì„œ ì²´í¬ê°€ ë¶ˆê°€ëŠ¥**í•˜ê³  ì˜¤ì§ ëŸ°íƒ€ì„ ì‹œì ì—ì„œ ì²´í¬ë¥¼ í•˜ê¸° ë•Œë¬¸ì— ê°œë°œìê°€ ì˜¤ë¥˜ë¥¼ ì°¾ëŠ”ë° ì–´ë ¤ì›€ì´ ìˆì—ˆìŠµë‹ˆë‹¤.   ì´ëŸ° ë¬¸ì œëŠ” `type-safe í•˜ì§€ ì•Šë‹¤`ê³  ë§í•©ë‹ˆë‹¤.`type-safe í•˜ë‹¤` -> **ì»´íŒŒì¼ ì‹œì ì—ì„œ ë¬¸ì œë¥¼ ì¡ì„ ìˆ˜ ìˆë‹¤.**## âš¡ï¸ QueryDSL ë¡œ í•´ê²°QueryDSL ì„ ì‚¬ìš©í•˜ë©´ ì¿¼ë¦¬ë¥¼ ë©”ì†Œë“œë¡œ ì œì–´í•´ì„œ ì»´íŒŒì¼ ì‹œì ì—ì„œ ì¿¼ë¦¬ì˜ ì˜¤ë¥˜ë¥¼ ì¡ì•„ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì•ì„œ ì‚´í´ë³¸ Spring Data JPAì—ëŠ” ( ë™ì ì¸ ì¿¼ë¦¬ì— ëŒ€í•œ ) ì¡°íšŒì—ì„œ ì•½ì ì´ ìˆì—ˆìŠµë‹ˆë‹¤.QueryDSLë¡œ ë³µì¡í•œ ì¡°íšŒ ê¸°ëŠ¥ì„ ë³´ì™„í•˜ê³  ê·¸ ì™¸ ë‹¨ìˆœí•œ ê²½ìš°ëŠ” Spring Data JPAë¥¼ ì‚¬ìš©í•©ì‹œë‹¤.ì£¼ë¡œ, JPA ì¿¼ë¦¬(JPQL)ì— ì‚¬ìš©í•œë‹¤.## âš¡ï¸ ì‘ë™ ë°©ì‹![image](https://github.com/jub3907/Spring-study/assets/58246682/a69eb821-af2c-4536-bbf1-2ed5d964b68a)<br/><br/>## âš¡ï¸ ì¥ë‹¨ì Type-Safeí•˜ê³ , ë‹¨ìˆœí•˜ê³ , ì‰½ë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.\ë‹¤ë§Œ, Qì½”ë“œ ìƒì„±ì„ ìœ„í•œ APT(Annotation Process Tool)ë¥¼ \ì„¤ì •í•´ì•¼ í•œë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬í•œë‹¤.<br/><br/><br/># ğŸ’¡ Querydsl ì„¤ì •## âš¡ï¸ build.gradle```groovydependencies {    //Querydsl ì¶”ê°€    implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'    annotationProcessor "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jakarta"    annotationProcessor "jakarta.annotation:jakarta.annotation-api"    annotationProcessor "jakarta.persistence:jakarta.persistence-api"}//Querydsl ì¶”ê°€, ìë™ ìƒì„±ëœ Qí´ë˜ìŠ¤ gradle cleanìœ¼ë¡œ ì œê±°clean {    delete file('src/main/generated')}```## âš¡ï¸ ê²€ì¦ - Q íƒ€ì… ìƒì„± í™•ì¸ ë°©ë²•`Preferences -> Build, Execution, Deployment -> Build Tools -> Gradle`![image](https://github.com/jub3907/Spring-study/assets/58246682/75772094-c9b9-4f42-b931-607780a9cccb)### ğŸ”‹ ì˜µì…˜ ì„ íƒ1 - Gradle - Qíƒ€ì… ìƒì„± í™•ì¸ ë°©ë²•* **Gradle IntelliJ ì‚¬ìš©ë²•**    * Gradle -> Tasks -> build -> clean    * Gradle -> Tasks -> other -> compileJava* **Gradle ì½˜ì†” ì‚¬ìš©ë²•**    * ./gradlew clean compileJava* Q íƒ€ì… ìƒì„± í™•ì¸    * `build -> generated -> sources -> annotationProcessor -> java/main` í•˜ìœ„ì— hello.itemservice.domain.QItem ì´ ìƒì„±ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤> ì°¸ê³ : Qíƒ€ì…ì€ ì»´íŒŒì¼ ì‹œì ì— ìë™ ìƒì„±ë˜ë¯€ë¡œ ë²„ì „ê´€ë¦¬(GIT)ì— í¬í•¨í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ë‹¤.  > gradle ì˜µì…˜ì„ ì„ íƒí•˜ë©´ Qíƒ€ì…ì€ gradle build í´ë” ì•„ë˜ì— ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ì—¬ê¸°ë¥¼ í¬í•¨í•˜ì§€ ì•Šì•„ì•¼ í•œë‹¤.   > ëŒ€ë¶€ë¶„ gradle build í´ë”ë¥¼ gitì— í¬í•¨í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì´ ë¶€ë¶„ì€ ìì—°ìŠ¤ëŸ½ê²Œ í•´ê²°ëœë‹¤.<br/>### ğŸ”‹ Qíƒ€ì… ì‚­ì œgradle clean ì„ ìˆ˜í–‰í•˜ë©´ build í´ë” ìì²´ê°€ ì‚­ì œëœë‹¤.  ë”°ë¼ì„œ ë³„ë„ì˜ ì„¤ì •ì€ ì—†ì–´ë„ ëœë‹¤.<br/>### ğŸ”‹ ì˜µì…˜ ì„ íƒ2 - IntelliJ IDEA - Qíƒ€ì… ìƒì„± í™•ì¸ ë°©ë²•- Build -> Build Project ë˜ëŠ” - Build -> Rebuild ë˜ëŠ”- main() ë˜ëŠ”- í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ëœë‹¤.`src/main/generated` í•˜ìœ„ì— `hello.itemservice.domain.QItem` ì´ ìƒì„±ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.> ì°¸ê³ : Qíƒ€ì…ì€ ì»´íŒŒì¼ ì‹œì ì— ìë™ ìƒì„±ë˜ë¯€ë¡œ ë²„ì „ê´€ë¦¬(GIT)ì— í¬í•¨í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ë‹¤.> IntelliJ IDEA ì˜µì…˜ì„ ì„ íƒí•˜ë©´ Qíƒ€ì…ì€ `src/main/generated` í´ë” ì•„ë˜ì— ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ì—¬ê¸°ë¥¼ í¬í•¨í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ë‹¤.<br/>### ğŸ”‹ Qíƒ€ì… ì‚­ì œ```java//Querydsl ì¶”ê°€, ìë™ ìƒì„±ëœ Qí´ë˜ìŠ¤ gradle cleanìœ¼ë¡œ ì œê±°clean {    delete file('src/main/generated')}````IntelliJ IDEA` ì˜µì…˜ì„ ì„ íƒí•˜ë©´ `src/main/generated` ì— íŒŒì¼ì´ ìƒì„±ë˜ê³ , í•„ìš”í•œ ê²½ìš° QíŒŒì¼ì„ ì§ì ‘ ì‚­ì œí•´ì•¼ í•œë‹¤.`gradle` ì— í•´ë‹¹ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í•˜ë©´ `gradle clean` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ë•Œ `src/main/generated` ì˜ íŒŒì¼ë„ í•¨ê»˜ ì‚­ì œí•´ì¤€ë‹¤.<br/><br/><br/>## Querydsl ì ìš©### JpaItemRepositoryV3```java@Repository@Transactionalpublic class JpaItemRepositoryV3 implements ItemRepository {    private final EntityManager em;    private final JPAQueryFactory query;    public JpaItemRepositoryV3(EntityManager em) {        this.em = em;        this.query = new JPAQueryFactory(em);    }    @Override    public Item save(Item item) {        em.persist(item);        return item;    }    @Override    public void update(Long itemId, ItemUpdateDto updateParam) {        Item findItem = em.find(Item.class, itemId);        findItem.setItemName(updateParam.getItemName());        findItem.setPrice(updateParam.getPrice());        findItem.setQuantity(updateParam.getQuantity());    }    @Override    public Optional<Item> findById(Long id) {        Item item = em.find(Item.class, id);        return Optional.ofNullable(item);    }    public List<Item> findAllOld(ItemSearchCond cond) {        String itemName = cond.getItemName();        Integer maxPrice = cond.getMaxPrice();//        QItem item = new QItem("i");        QItem item = QItem.item;        BooleanBuilder builder = new BooleanBuilder();        if (maxPrice != null) {            builder.and(item.price.loe(maxPrice));        }        List<Item> result = query                .select(item)                .from(item)                .where(builder)                .fetch();        return result;    }    @Override    public List<Item> findAll(ItemSearchCond cond) {        String itemName = cond.getItemName();        Integer maxPrice = cond.getMaxPrice();        return query.select(item)                .from(item)                .where(likeItemName(itemName), maxPrice(maxPrice))                .fetch();    }    private BooleanExpression maxPrice(Integer maxPrice) {        if (maxPrice != null) {            return item.price.loe(maxPrice);        }        return null;    }    private BooleanExpression likeItemName(String itemName) {        if (StringUtils.hasText(itemName)) {            return item.itemName.like("%" + itemName + "%");        }        return null;    }}```<br/>#### ê³µí†µQuerydslì„ ì‚¬ìš©í•˜ë ¤ë©´ JPAQueryFactory ê°€ í•„ìš”í•˜ë‹¤.\JPAQueryFactory ëŠ” JPA ì¿¼ë¦¬ì¸ JPQLì„ ë§Œë“¤ê¸° ë•Œë¬¸ì— EntityManager ê°€ í•„ìš”í•˜ë‹¤.ì„¤ì • ë°©ì‹ì€ JdbcTemplate ì„ ì„¤ì •í•˜ëŠ” ê²ƒê³¼ ìœ ì‚¬í•˜ë‹¤.\ì°¸ê³ ë¡œ JPAQueryFactory ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì„œ ì‚¬ìš©í•´ë„ ëœë‹¤.<br/>#### save(), update(), findById()ê¸°ë³¸ ê¸°ëŠ¥ë“¤ì€ JPAê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤<br/><br/>#### findAllOldQuerydslì„ ì‚¬ìš©í•´ì„œ ë™ì  ì¿¼ë¦¬ ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤.\BooleanBuilder ë¥¼ ì‚¬ìš©í•´ì„œ ì›í•˜ëŠ” where ì¡°ê±´ë“¤ì„ ë„£ì–´ì£¼ë©´ ëœë‹¤.\ì´ ëª¨ë“  ê²ƒì„ ìë°” ì½”ë“œë¡œ ì‘ì„±í•˜ê¸° ë•Œë¬¸ì— ë™ì  ì¿¼ë¦¬ë¥¼ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.<br/><br/>#### findAllì•ì„œ findAllOld ì—ì„œ ì‘ì„±í•œ ì½”ë“œë¥¼ ê¹”ë”í•˜ê²Œ ë¦¬íŒ©í† ë§ í–ˆë‹¤. \ë‹¤ìŒ ì½”ë“œëŠ” ëˆ„ê°€ ë´ë„ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.```javaList<Item> result = query        .select(item)        .from(item)        .where(likeItemName(itemName), maxPrice(maxPrice))        .fetch();```Querydslì—ì„œ where(A,B) ì— ë‹¤ì–‘í•œ ì¡°ê±´ë“¤ì„ ì§ì ‘ ë„£ì„ ìˆ˜ ìˆëŠ”ë°, \ì´ë ‡ê²Œ ë„£ìœ¼ë©´ AND ì¡°ê±´ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤. \ì°¸ê³ ë¡œ where() ì— null ì„ ì…ë ¥í•˜ë©´ í•´ë‹¹ ì¡°ê±´ì€ ë¬´ì‹œí•œë‹¤.ì´ ì½”ë“œì˜ ë˜ ë‹¤ë¥¸ ì¥ì ì€ likeItemName() , maxPrice() ë¥¼ ë‹¤ë¥¸ ì¿¼ë¦¬ë¥¼ \ì‘ì„±í•  ë•Œ ì¬ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤. \ì‰½ê²Œ ì´ì•¼ê¸°í•´ì„œ ì¿¼ë¦¬ ì¡°ê±´ì„ ë¶€ë¶„ì ìœ¼ë¡œ ëª¨ë“ˆí™” í•  ìˆ˜ ìˆë‹¤. \ìë°” ì½”ë“œë¡œ ê°œë°œí•˜ê¸° ë•Œë¬¸ì— ì–»ì„ ìˆ˜ ìˆëŠ” í° ì¥ì ì´ë‹¤.ì´ì œ ì„¤ì •í•˜ê³  ì‹¤í–‰í•´ë³´ì.<br/><br/>### QuerydslConfig```java@Configuration@RequiredArgsConstructorpublic class QuerydslConfig {    private final EntityManager em;    @Bean    public ItemService itemService() {        return new ItemServiceV1(itemRepository());    }    @Bean    public ItemRepository itemRepository() {        return new JpaItemRepositoryV3(em);    }}```<br/><br/>### ItemServiceApplication - ë³€ê²½```java//@Import(SpringDataJpaConfig.class)@Import(QuerydslConfig.class)@SpringBootApplication(scanBasePackages = "hello.itemservice.web")public class ItemServiceApplication {}```QuerydslConfig ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½í–ˆë‹¤.<br/><br/>#### ì˜ˆì™¸ ë³€í™˜Querydsl ì€ ë³„ë„ì˜ ìŠ¤í”„ë§ ì˜ˆì™¸ ì¶”ìƒí™”ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤. \ëŒ€ì‹ ì— JPAì—ì„œ í•™ìŠµí•œ ê²ƒ ì²˜ëŸ¼ @Repository ì—ì„œ ìŠ¤í”„ë§ ì˜ˆì™¸ ì¶”ìƒí™”ë¥¼ ì²˜ë¦¬í•´ì¤€ë‹¤.<br/><br/>## ì •ë¦¬### Querydsl ì¥ì Querydsl ë•ë¶„ì— ë™ì  ì¿¼ë¦¬ë¥¼ ë§¤ìš° ê¹”ë”í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.```javaList<Item> result = query        .select(item)        .from(item)        .where(likeItemName(itemName), maxPrice(maxPrice))        .fetch();```ì¿¼ë¦¬ ë¬¸ì¥ì— ì˜¤íƒ€ê°€ ìˆì–´ë„ ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ë¥¼ ë§‰ì„ ìˆ˜ ìˆë‹¤.\ë©”ì„œë“œ ì¶”ì¶œì„ í†µí•´ì„œ ì½”ë“œë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. \ì˜ˆë¥¼ ë“¤ì–´ì„œ ì—¬ê¸°ì„œ ë§Œë“  likeItemName(itemName) , \maxPrice(maxPrice) ë©”ì„œë“œë¥¼ ë‹¤ë¥¸ ì¿¼ë¦¬ì—ì„œë„ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.Querydslì„ ì‚¬ìš©í•´ì„œ ìë°” ì½”ë“œë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ì¥ì ì„ ëŠê»´ë³´ì•˜ì„ ê²ƒì´ë‹¤.\ê·¸ë¦¬ê³  ë™ì  ì¿¼ë¦¬ ë¬¸ì œë„ ê¹”ë”í•˜ê²Œ í•´ê²°í•´ë³´ì•˜ë‹¤.\Querydslì€ ì´ ì™¸ì—ë„ ìˆ˜ ë§ì€ í¸ë¦¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. \ì˜ˆë¥¼ ë“¤ì–´ì„œ ìµœì ì˜ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œ DTOë¡œ í¸ë¦¬í•˜ê²Œ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ì€ \ì‹¤ë¬´ì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. JPAë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ìŠ¤í”„ë§ ë°ì´í„° JPAì™€ \Querydslì€ ì‹¤ë¬´ì˜ ë‹¤ì–‘í•œ ë¬¸ì œë¥¼ í¸ë¦¬í•˜ê²Œ í•´ê²°í•˜ê¸° ìœ„í•´ ì„ íƒí•˜ëŠ” ê¸°ë³¸ ê¸°ìˆ ì´ë¼ ìƒê°í•œë‹¤.<br/><br/>