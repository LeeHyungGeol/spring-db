# 10. ìŠ¤í”„ë§ íŠ¸ëœì­ì…˜ ì „íŒŒ1 - ê¸°ë³¸<br/>## ëª©ì°¨- ì»¤ë°‹, ë¡¤ë°±- íŠ¸ëœì­ì…˜ ë‘ ë²ˆ ì‚¬ìš©- íŠ¸ëœì­ì…˜ ì „íŒŒ- íŠ¸ëœì­ì…˜ ì „íŒŒ - ë‘˜ ë‹¤ ì»¤ë°‹- íŠ¸ëœì­ì…˜ ì „íŒŒ - ì™¸ë¶€ ë¡¤ë°±- íŠ¸ëœì­ì…˜ ì „íŒŒ - ë‚´ë¶€ ë¡¤ë°±<br/><br/><br/># ğŸ’¡ ì»¤ë°‹, ë¡¤ë°±- íŠ¸ëœì­ì…˜ì´ **ë‘˜ ì´ìƒ ìˆì„ ë•Œ** ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€- **ìŠ¤í”„ë§**ì´ ì œê³µí•˜ëŠ” `íŠ¸ëœì­ì…˜ ì „íŒŒ (propagation)`ë¼ëŠ” ê°œë…ë„ ì•Œì•„ë³´ì.## âš¡ï¸ BasicTxTest```java@Slf4j@SpringBootTestpublic class BasicTxTest {    @Autowired    PlatformTransactionManager txManager;    @TestConfiguration      static class Config {        @Bean        public PlatformTransactionManager transactionManager(DataSource dataSource) {            return new DataSourceTransactionManager(dataSource);        }    }    @Test    void commit() {        log.info("íŠ¸ëœì ì…˜ ì‹œì‘");        TransactionStatus status = txManager.getTransaction(new DefaultTransactionAttribute());        log.info("íŠ¸ëœì ì…˜ ì»¤ë°‹ ì‹œì‘");        txManager.commit(status);        log.info("íŠ¸ëœì ì…˜ ì»¤ë°‹ ì™„ë£Œ");    }    @Test    void rollback() {        log.info("íŠ¸ëœì­ì…˜ ì‹œì‘");        TransactionStatus status = txManager.getTransaction(new DefaultTransactionAttribute());        log.info("íŠ¸ëœì­ì…˜ ë¡¤ë°± ì‹œì‘");        txManager.rollback(status);        log.info("íŠ¸ëœì­ì…˜ ë¡¤ë°± ì™„ë£Œ");    }}```* `@TestConfiguration` : í•´ë‹¹ í…ŒìŠ¤íŠ¸ì—ì„œ í•„ìš”í•œ ìŠ¤í”„ë§ ì„¤ì •ì„ ì¶”ê°€ë¡œ í•  ìˆ˜ ìˆë‹¤.* `DataSourceTransactionManager` ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í–ˆë‹¤. \  ì´í›„ íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ì¸ PlatformTransactionManager ë¥¼ ì£¼ì… ë°›ìœ¼ë©´ ë°©ê¸ˆ ë“±ë¡í•œ DataSourceTransactionManager ê°€ ì£¼ì…ëœë‹¤.`application.properties` ì¶”ê°€```propertieslogging.level.org.springframework.transaction.interceptor=TRACElogging.level.org.springframework.jdbc.datasource.DataSourceTransactionManager=DEBUG#JPA loglogging.level.org.springframework.orm.jpa.JpaTransactionManager=DEBUGlogging.level.org.hibernate.resource.transaction=DEBUG#JPA SQLlogging.level.org.hibernate.SQL=DEBUG```<br/><br/>### ğŸ”‹ commit()`txManager.getTransaction(new DefaultTransactionAttribute())`\íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘(íšë“)í•œë‹¤.`txManager.commit(status)` íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.<br/>```c.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜ ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Creating new transaction with name [null]: PROPAGATION_REQUIRED,ISOLATION_DEFAULTo.s.j.d.DataSourceTransactionManager     : Acquired Connection [HikariProxyConnection@2114535884 wrapping conn0: url=jdbc:h2:mem:322ebda7-06d8-4840-a214-f2c2def88c5a user=SA] for JDBC transactiono.s.j.d.DataSourceTransactionManager     : Switching JDBC Connection [HikariProxyConnection@2114535884 wrapping conn0: url=jdbc:h2:mem:322ebda7-06d8-4840-a214-f2c2def88c5a user=SA] to manual commitc.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Initiating transaction commito.s.j.d.DataSourceTransactionManager     : Committing JDBC transaction on Connection [HikariProxyConnection@2114535884 wrapping conn0: url=jdbc:h2:mem:322ebda7-06d8-4840-a214-f2c2def88c5a user=SA]o.s.j.d.DataSourceTransactionManager     : Releasing JDBC Connection [HikariProxyConnection@2114535884 wrapping conn0: url=jdbc:h2:mem:322ebda7-06d8-4840-a214-f2c2def88c5a user=SA] after transactionc.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì™„ë£Œ```<br/>### ğŸ”‹ rollback()`txManager.getTransaction(new DefaultTransactionAttribute())`\íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘(íšë“)í•œë‹¤.`txManager.rollback(status)` íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•œë‹¤.<br/>```c.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜ ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Creating new transaction with name [null]: PROPAGATION_REQUIRED,ISOLATION_DEFAULTo.s.j.d.DataSourceTransactionManager     : Acquired Connection [HikariProxyConnection@942016720 wrapping conn0: url=jdbc:h2:mem:53a4d8d5-5b6b-4f7c-bbc8-510afa3378a5 user=SA] for JDBC transactiono.s.j.d.DataSourceTransactionManager     : Switching JDBC Connection [HikariProxyConnection@942016720 wrapping conn0: url=jdbc:h2:mem:53a4d8d5-5b6b-4f7c-bbc8-510afa3378a5 user=SA] to manual commitc.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜ ë¡¤ë°± ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Initiating transaction rollbacko.s.j.d.DataSourceTransactionManager     : Rolling back JDBC transaction on Connection [HikariProxyConnection@942016720 wrapping conn0: url=jdbc:h2:mem:53a4d8d5-5b6b-4f7c-bbc8-510afa3378a5 user=SA]o.s.j.d.DataSourceTransactionManager     : Releasing JDBC Connection [HikariProxyConnection@942016720 wrapping conn0: url=jdbc:h2:mem:53a4d8d5-5b6b-4f7c-bbc8-510afa3378a5 user=SA] after transactionc.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜ ë¡¤ë°± ì™„ë£Œ```<br/><br/><br/># ğŸ’¡ íŠ¸ëœì­ì…˜ ë‘ ë²ˆ ì‚¬ìš©> ì—¬ê¸°ì„œëŠ” íŠ¸ëœì­ì…˜1ì´ ì™„ì „íˆ ëë‚˜ê³ ë‚˜ì„œ íŠ¸ëœì­ì…˜2ë¥¼ ìˆ˜í–‰í•œë‹¤.## âš¡ï¸ double_commit() - BasicTxTest ì¶”ê°€```java@Testvoid double_commit() {    log.info("íŠ¸ëœì­ì…˜1 ì‹œì‘");    TransactionStatus tx1 = txManager.getTransaction(new DefaultTransactionAttribute());    log.info("íŠ¸ëœì­ì…˜1 ì»¤ë°‹ ì‹œì‘");    txManager.commit(tx1);    log.info("íŠ¸ëœì­ì…˜1 ì»¤ë°‹ ì™„ë£Œ");    log.info("íŠ¸ëœì­ì…˜2 ì‹œì‘");    TransactionStatus tx2 = txManager.getTransaction(new DefaultTransactionAttribute());    log.info("íŠ¸ëœì­ì…˜2 ì»¤ë°‹ ì‹œì‘");    txManager.commit(tx2);    log.info("íŠ¸ëœì­ì…˜2 ì»¤ë°‹ ì™„ë£Œ");}```<br/>### ğŸ”‹ double_commit() - ì‹¤í–‰ ë¡œê·¸```c.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜1 ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Creating new transaction with name [null]: PROPAGATION_REQUIRED,ISOLATION_DEFAULTo.s.j.d.DataSourceTransactionManager     : Acquired Connection [HikariProxyConnection@1756618311 wrapping conn0: url=jdbc:h2:mem:d0fe0ac8-ca4d-4ea5-9acd-826276d19675 user=SA] for JDBC transactiono.s.j.d.DataSourceTransactionManager     : Switching JDBC Connection [HikariProxyConnection@1756618311 wrapping conn0: url=jdbc:h2:mem:d0fe0ac8-ca4d-4ea5-9acd-826276d19675 user=SA] to manual commitc.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜1 ì»¤ë°‹ ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Initiating transaction commito.s.j.d.DataSourceTransactionManager     : Committing JDBC transaction on Connection [HikariProxyConnection@1756618311 wrapping conn0: url=jdbc:h2:mem:d0fe0ac8-ca4d-4ea5-9acd-826276d19675 user=SA]o.s.j.d.DataSourceTransactionManager     : Releasing JDBC Connection [HikariProxyConnection@1756618311 wrapping conn0: url=jdbc:h2:mem:d0fe0ac8-ca4d-4ea5-9acd-826276d19675 user=SA] after transactionc.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜1 ì»¤ë°‹ ì™„ë£Œc.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜2 ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Creating new transaction with name [null]: PROPAGATION_REQUIRED,ISOLATION_DEFAULTo.s.j.d.DataSourceTransactionManager     : Acquired Connection [HikariProxyConnection@1739257986 wrapping conn0: url=jdbc:h2:mem:d0fe0ac8-ca4d-4ea5-9acd-826276d19675 user=SA] for JDBC transactiono.s.j.d.DataSourceTransactionManager     : Switching JDBC Connection [HikariProxyConnection@1739257986 wrapping conn0: url=jdbc:h2:mem:d0fe0ac8-ca4d-4ea5-9acd-826276d19675 user=SA] to manual commitc.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜2 ì»¤ë°‹ ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Initiating transaction commito.s.j.d.DataSourceTransactionManager     : Committing JDBC transaction on Connection [HikariProxyConnection@1739257986 wrapping conn0: url=jdbc:h2:mem:d0fe0ac8-ca4d-4ea5-9acd-826276d19675 user=SA]o.s.j.d.DataSourceTransactionManager     : Releasing JDBC Connection [HikariProxyConnection@1739257986 wrapping conn0: url=jdbc:h2:mem:d0fe0ac8-ca4d-4ea5-9acd-826276d19675 user=SA] after transactionc.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜2 ì»¤ë°‹ ì™„ë£Œ```<br/><br/>## âš¡ï¸ ì£¼ì˜!ë¡œê·¸ë¥¼ ë³´ë©´ íŠ¸ëœì­ì…˜1ê³¼ íŠ¸ëœì­ì…˜2ê°€ ê°™ì€ conn0 ì»¤ë„¥ì…˜ì„ ì‚¬ìš©ì¤‘ì´ë‹¤. \ì´ê²ƒì€ ì¤‘ê°„ì— ì»¤ë„¥ì…˜ í’€ ë•Œë¬¸ì— ê·¸ëŸ° ê²ƒì´ë‹¤. \íŠ¸ëœì­ì…˜1ì€ conn0 ì»¤ë„¥ì…˜ì„ ëª¨ë‘ ì‚¬ìš©í•˜ê³  ì»¤ë„¥ì…˜ í’€ì— ë°˜ë‚©ê¹Œì§€ ì™„ë£Œí–ˆë‹¤.   ì´í›„ì— íŠ¸ëœì­ì…˜2ê°€ conn0 ë¥¼ ì»¤ë„¥ì…˜ í’€ì—ì„œ íšë“í•œ ê²ƒì´ë‹¤. ë”°ë¼ì„œ ë‘˜ì€ ì™„ì „íˆ ë‹¤ë¥¸ ì»¤ë„¥ì…˜ìœ¼ë¡œ ì¸ì§€í•˜ëŠ” ê²ƒì´ ë§ë‹¤.**ê·¸ë ‡ë‹¤ë©´ ë‘˜ì„ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ” ë‹¤ë¥¸ ë°©ë²•ì€ ì—†ì„ê¹Œ?**> `íˆì¹´ë¦¬ ì»¤ë„¥ì…˜ í’€`ì—ì„œ ì»¤ë„¥ì…˜ì„ íšë“í•˜ë©´ ì‹¤ì œ ì»¤ë„¥ì…˜ì„ ê·¸ëŒ€ë¡œ ë°˜í™˜í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼   **ë‚´ë¶€ ê´€ë¦¬**ë¥¼ ìœ„í•´ `íˆì¹´ë¦¬ í”„ë¡ì‹œ ì»¤ë„¥ì…˜(HikariProxyConnection)`ì´ë¼ëŠ” **ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜í•œë‹¤.** ë¬¼ë¡  ë‚´ë¶€ì—ëŠ” ì‹¤ì œ ì»¤ë„¥ì…˜ì´ í¬í•¨ë˜ì–´ ìˆë‹¤.  ì´ ê°ì²´ì˜ ì£¼ì†Œë¥¼ í™•ì¸í•˜ë©´ ì»¤ë„¥ì…˜ í’€ì—ì„œ íšë“í•œ ì»¤ë„¥ì…˜ì„ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.* íŠ¸ëœì­ì…˜1: `Acquired Connection [HikariProxyConnection@1756618311 wrapping conn0]`* íŠ¸ëœì­ì…˜2: `Acquired Connection [HikariProxyConnection@1739257986 wrapping conn0]`íˆì¹´ë¦¬ ì»¤ë„¥ì…˜í’€ì´ ë°˜í™˜í•´ì£¼ëŠ” ì»¤ë„¥ì…˜ì„ ë‹¤ë£¨ëŠ” **í”„ë¡ì‹œ ê°ì²´ì˜ ì£¼ì†Œ**ê°€ \íŠ¸ëœì­ì…˜1ì€ `HikariProxyConnection@1756618311` ì´ê³ ,\íŠ¸ëœì­ì…˜2ëŠ” `HikariProxyConnection@1739257986` ìœ¼ë¡œ ì„œë¡œ ë‹¤ë¥¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.> ê²°ê³¼ì ìœ¼ë¡œ conn0 ì„ í†µí•´ ì»¤ë„¥ì…˜ì´ ì¬ì‚¬ìš© ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆê³ ,\HikariProxyConnection@1756618311 , HikariProxyConnection@1739257986 ì„ í†µí•´ \ê°ê° ì»¤ë„¥ì…˜ í’€ì—ì„œ ì»¤ë„¥ì…˜ì„ ì¡°íšŒí•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/a61983ac-8aee-4190-8965-82e080e7599a)![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/6d01cea8-01ca-4719-8ff2-a1e6bef03e00)íŠ¸ëœì­ì…˜ì´ ê°ê° ìˆ˜í–‰ë˜ë©´ì„œ ì‚¬ìš©ë˜ëŠ” DB ì»¤ë„¥ì…˜ë„ ê°ê° ë‹¤ë¥´ë‹¤.**ì´ ê²½ìš° íŠ¸ëœì­ì…˜ì„ ê°ì ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— ì „ì²´ íŠ¸ëœì­ì…˜ì„ ë¬¶ì„ ìˆ˜ ì—†ë‹¤.**<br/><br/>## âš¡ï¸ double_commit_rollback() - BasicTxTest ì¶”ê°€```java@Testvoid double_commit_rollback() {    log.info("íŠ¸ëœì­ì…˜1 ì‹œì‘");    TransactionStatus tx1 = txManager.getTransaction(new DefaultTransactionAttribute());    log.info("íŠ¸ëœì­ì…˜1 ì»¤ë°‹"); txManager.commit(tx1);        log.info("íŠ¸ëœì­ì…˜2 ì‹œì‘");    TransactionStatus tx2 = txManager.getTransaction(new DefaultTransactionAttribute());    log.info("íŠ¸ëœì­ì…˜2 ë¡¤ë°±");    txManager.rollback(tx2);}```ì˜ˆì œì—ì„œëŠ” íŠ¸ëœì­ì…˜1ì€ ì»¤ë°‹í•˜ê³ , íŠ¸ëœì­ì…˜2ëŠ” ë¡¤ë°±í•œë‹¤.ì „ì²´ íŠ¸ëœì­ì…˜ì„ ë¬¶ì§€ ì•Šê³  ê°ê° ê´€ë¦¬í–ˆê¸° ë•Œë¬¸ì—,  íŠ¸ëœì­ì…˜1ì—ì„œ ì €ì¥í•œ ë°ì´í„°ëŠ” ì»¤ë°‹ë˜ê³ , íŠ¸ëœì­ì…˜2 ì—ì„œ ì €ì¥í•œ ë°ì´í„°ëŠ” ë¡¤ë°±ëœë‹¤.<br/>## âš¡ï¸ double_commit_rollback() - ì‹¤í–‰ ë¡œê·¸```c.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜1 ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Creating new transaction with name [null]: PROPAGATION_REQUIRED,ISOLATION_DEFAULTo.s.j.d.DataSourceTransactionManager     : Acquired Connection [HikariProxyConnection@2021678579 wrapping conn0: url=jdbc:h2:mem:0b87c5c5-0821-41f8-bf4d-fbf6e999390a user=SA] for JDBC transactiono.s.j.d.DataSourceTransactionManager     : Switching JDBC Connection [HikariProxyConnection@2021678579 wrapping conn0: url=jdbc:h2:mem:0b87c5c5-0821-41f8-bf4d-fbf6e999390a user=SA] to manual commitc.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜1 ì»¤ë°‹o.s.j.d.DataSourceTransactionManager     : Initiating transaction commito.s.j.d.DataSourceTransactionManager     : Committing JDBC transaction on Connection [HikariProxyConnection@2021678579 wrapping conn0: url=jdbc:h2:mem:0b87c5c5-0821-41f8-bf4d-fbf6e999390a user=SA]o.s.j.d.DataSourceTransactionManager     : Releasing JDBC Connection [HikariProxyConnection@2021678579 wrapping conn0: url=jdbc:h2:mem:0b87c5c5-0821-41f8-bf4d-fbf6e999390a user=SA] after transactionc.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜2 ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Creating new transaction with name [null]: PROPAGATION_REQUIRED,ISOLATION_DEFAULTo.s.j.d.DataSourceTransactionManager     : Acquired Connection [HikariProxyConnection@241108472 wrapping conn0: url=jdbc:h2:mem:0b87c5c5-0821-41f8-bf4d-fbf6e999390a user=SA] for JDBC transactiono.s.j.d.DataSourceTransactionManager     : Switching JDBC Connection [HikariProxyConnection@241108472 wrapping conn0: url=jdbc:h2:mem:0b87c5c5-0821-41f8-bf4d-fbf6e999390a user=SA] to manual commitc.b.tx.propagation.BasicTxTest           : íŠ¸ëœì­ì…˜2 ë¡¤ë°±o.s.j.d.DataSourceTransactionManager     : Initiating transaction rollbacko.s.j.d.DataSourceTransactionManager     : Rolling back JDBC transaction on Connection [HikariProxyConnection@241108472 wrapping conn0: url=jdbc:h2:mem:0b87c5c5-0821-41f8-bf4d-fbf6e999390a user=SA]o.s.j.d.DataSourceTransactionManager     : Releasing JDBC Connection [HikariProxyConnection@241108472 wrapping conn0: url=jdbc:h2:mem:0b87c5c5-0821-41f8-bf4d-fbf6e999390a user=SA] after transaction```ë¡œê·¸ë¥¼ ë³´ë©´ íŠ¸ëœì­ì…˜1ì€ ì»¤ë°‹ë˜ì§€ë§Œ, íŠ¸ëœì­ì…˜2ëŠ” ë¡¤ë°±ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/d91c00f1-5263-4589-9a5d-16cd017a695c)![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/ea7a4b24-720e-406b-a46e-69f3db7028da)<br/><br/><br/># ğŸ’¡ íŠ¸ëœì­ì…˜ ì „íŒŒ> íŠ¸ëœì­ì…˜ì„ ê°ê° ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **íŠ¸ëœì­ì…˜ì´ ì´ë¯¸ ì§„í–‰ì¤‘ì¸ë°, ì—¬ê¸°ì— ì¶”ê°€ë¡œ íŠ¸ëœì­ì…˜ì„ ìˆ˜í–‰**í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?ì´ëŸ° ê²½ìš° ì–´ë–»ê²Œ ë™ì‘í• ì§€ ê²°ì •í•˜ëŠ” ê²ƒì„ `íŠ¸ëœì­ì…˜ ì „íŒŒ(propagation)`ë¼ í•œë‹¤.- ì§€ê¸ˆë¶€í„° ì„¤ëª…í•˜ëŠ” ë‚´ìš©ì€ **íŠ¸ëœì­ì…˜ ì „íŒŒì˜ ê¸°ë³¸ ì˜µì…˜**ì¸ `REQUIRED` ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•œë‹¤.## **âš¡ï¸ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì´ ìˆ˜í–‰ì¤‘ì¸ë°, ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ ì¶”ê°€ë¡œ ìˆ˜í–‰ë¨**![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/d6be3864-6ed5-4e31-9c04-34343119c11d)ì™¸ë¶€ íŠ¸ëœì­ì…˜ì´ ìˆ˜í–‰ì¤‘ì´ê³ , ì•„ì§ ëë‚˜ì§€ ì•Šì•˜ëŠ”ë°, ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ ìˆ˜í–‰ëœë‹¤.**ë‘˜ ì¤‘ ìƒëŒ€ì ìœ¼ë¡œ ë°–ì— ìˆê¸° ë•Œë¬¸ì— `ì™¸ë¶€ íŠ¸ëœì­ì…˜`ì´ë¼ í•œë‹¤. ì²˜ìŒ ì‹œì‘ëœ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì´í•´í•˜ë©´ ëœë‹¤.**`ë‚´ë¶€ íŠ¸ëœì­ì…˜`ì€ **ì™¸ë¶€ì— íŠ¸ëœì­ì…˜ì´ ìˆ˜í–‰ë˜ê³  ìˆëŠ” ë„ì¤‘ì— í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì—**   ë§ˆì¹˜ ë‚´ë¶€ì— ìˆëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì—¬ì„œ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ë¼ í•œë‹¤.![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/4f6a7ef7-aa7d-4600-8622-2116faa7cae7)> ìŠ¤í”„ë§ì—ì„œ ì´ ê²½ìš° ì™¸ë¶€ íŠ¸ëœì­ì…˜ê³¼ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ë¬¶ì–´ì„œ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì„ ë§Œë“¤ì–´ì¤€ë‹¤.ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•˜ëŠ” ê²ƒì´ë‹¤.   ì´ê²ƒì´ ê¸°ë³¸ ë™ì‘ì´ê³ , ì˜µì…˜ì„ í†µí•´ ë‹¤ë¥¸ ë™ì‘ë°©ì‹ë„ ì„ íƒí•  ìˆ˜ ìˆë‹¤.<br/><br/>## âš¡ï¸ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜, ë…¼ë¦¬ íŠ¸ëœì­ì…˜![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/8b8b7a4f-74d7-435a-a4d2-22a477a84354)- ìŠ¤í”„ë§ì€ ì´í•´ë¥¼ ë•ê¸° ìœ„í•´ `ë…¼ë¦¬ íŠ¸ëœì­ì…˜`ê³¼ `ë¬¼ë¦¬ íŠ¸ëœì­ì…˜`ì´ë¼ëŠ” ê°œë…ì„ ë‚˜ëˆˆë‹¤.- ë…¼ë¦¬ íŠ¸ëœì­ì…˜ë“¤ì€ í•˜ë‚˜ì˜ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì¸ë‹¤.- **ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì€ ìš°ë¦¬ê°€ ì´í•´í•˜ëŠ” ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ìš©ë˜ëŠ” íŠ¸ëœì­ì…˜ì„ ëœ»í•œë‹¤.** ì‹¤ì œ ì»¤ë„¥ì…˜ì„ í†µí•´ì„œ  íŠ¸ëœì­ì…˜ì„ ì‹œì‘( `setAutoCommit(false)`) í•˜ê³ , ì‹¤ì œ ì»¤ë„¥ì…˜ì„ í†µí•´ì„œ ì»¤ë°‹, ë¡¤ë°±í•˜ëŠ” ë‹¨ìœ„ì´ë‹¤.- ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì€ íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë‹¨ìœ„ì´ë‹¤.- ì´ëŸ¬í•œ ë…¼ë¦¬ íŠ¸ëœì­ì…˜ ê°œë…ì€ íŠ¸ëœì­ì…˜ì´ ì§„í–‰ë˜ëŠ” ì¤‘ì— ë‚´ë¶€ì— ì¶”ê°€ë¡œ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—  ë‚˜íƒ€ë‚œë‹¤. ë‹¨ìˆœíˆ íŠ¸ëœì­ì…˜ì´ í•˜ë‚˜ì¸ ê²½ìš° ë‘˜ì„ êµ¬ë¶„í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. (ë” ì •í™•íˆëŠ” `REQUIRED` ì „íŒŒ ì˜µì…˜ì„  ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì— ë‚˜íƒ€ë‚˜ê³ , ì´ ì˜µì…˜ì€ ë’¤ì—ì„œ ì„¤ëª…í•œë‹¤.)ê·¸ëŸ¼ ì™œ ì´ë ‡ê²Œ ë…¼ë¦¬ íŠ¸ëœì­ì…˜ê³¼ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ë‚˜ëˆ„ì–´ ì„¤ëª…í•˜ëŠ” ê²ƒì¼ê¹Œ?  íŠ¸ëœì­ì…˜ì´ ì‚¬ìš©ì¤‘ì¼ ë•Œ ë˜ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ë‚´ë¶€ì— ì‚¬ìš©ë˜ë©´ ì—¬ëŸ¬ê°€ì§€ ë³µì¡í•œ ìƒí™©ì´ ë°œìƒí•œë‹¤.   ì´ë•Œ ë…¼ë¦¬ íŠ¸ëœì­ì…˜ ê°œë…ì„ ë„ì…í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë‹¨ìˆœí•œ ì›ì¹™ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.## âš¡ï¸ ì›ì¹™> - **ëª¨ë“  ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë˜ì–´ì•¼ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ëœë‹¤.(ëª¨ë“  íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ ì»¤ë°‹í•´ì•¼ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ëœë‹¤.)**> - **í•˜ë‚˜ì˜ ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì´ë¼ë„ ë¡¤ë°±ë˜ë©´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì€ ë¡¤ë°±ëœë‹¤.(í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¼ë„ ë¡¤ë°±í•˜ë©´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì€ ë¡¤ë°±ëœë‹¤.)**![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/9d9ebe40-4733-4487-80b8-258304dfb743)* ëª¨ë“  ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ ë˜ì—ˆìœ¼ë¯€ë¡œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ë„ ì»¤ë°‹ëœë‹¤.![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/b457a52b-1292-448a-b56c-adb748bfa09f)* ì™¸ë¶€ ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°± ë˜ì—ˆìœ¼ë¯€ë¡œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì€ ë¡¤ë°±ëœë‹¤.![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/bff0f055-75df-4b0a-acb0-9da688292e34)* ë‚´ë¶€ ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°± ë˜ì—ˆìœ¼ë¯€ë¡œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì€ ë¡¤ë°±ëœë‹¤<br/><br/><br/># ğŸ’¡ íŠ¸ëœì­ì…˜ ì „íŒŒ - ë‘˜ ë‹¤ ì»¤ë°‹> ì—¬ê¸°ì„œ í•µì‹¬ì€ **íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ì— ì»¤ë°‹ì„ í˜¸ì¶œí•œë‹¤ê³ í•´ì„œ í•­ìƒ ì‹¤ì œ ì»¤ë„¥ì…˜ì— ë¬¼ë¦¬ ì»¤ë°‹ì´ ë°œìƒí•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤ëŠ” ì ì´ë‹¤.**>> **íŠ¸ëœì­ì…˜ì´ ë‚´ë¶€ì—ì„œ ì¶”ê°€ë¡œ ì‚¬ìš©ë˜ë©´, íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•˜ê³ , ëª¨ë“  ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë˜ë©´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ëœë‹¤ê³  ì´í•´í•˜ë©´ ëœë‹¤.**![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/ba9d011e-f89c-43d3-baef-802e144aecc7)<br/>## âš¡ï¸ inner_commit() - BasicTxTest ì¶”ê°€```java @Testvoid inner_commit() {    log.info("ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘");    TransactionStatus outer = txManager.getTransaction(new DefaultTransactionAttribute());    log.info("outer.isNewTransaction()={}", outer.isNewTransaction());        log.info("ë‚´ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘");    TransactionStatus inner = txManager.getTransaction(new DefaultTransactionAttribute());    log.info("inner.isNewTransaction()={}", inner.isNewTransaction()); log.info("ë‚´ë¶€ íŠ¸ëœì­ì…˜ ì»¤ë°‹");    txManager.commit(inner);        log.info("ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì»¤ë°‹");    txManager.commit(outer);}```* ì™¸ë¶€ íŠ¸ëœì­ì…˜ì´ ìˆ˜í–‰ì¤‘ì¸ë°, ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì¶”ê°€ë¡œ ìˆ˜í–‰í–ˆë‹¤.* ì™¸ë¶€ íŠ¸ëœì­ì…˜ì€ ì²˜ìŒ ìˆ˜í–‰ëœ íŠ¸ëœì­ì…˜ì´ë‹¤.* ì´ ê²½ìš° ì‹ ê·œ íŠ¸ëœì­ì…˜( `isNewTransaction=true` )ì´ ëœë‹¤.* ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ëŠ” ì‹œì ì—ëŠ” ì´ë¯¸ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì´ ì§„í–‰ì¤‘ì¸ ìƒíƒœì´ë‹¤. \  **ì´ ê²½ìš° ë‚´ë¶€ íŠ¸ëœì­ì…˜ì€ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•œë‹¤.*** íŠ¸ëœì­ì…˜ ì°¸ì—¬    * ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•œë‹¤ëŠ” ëœ»ì€ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ê·¸ëŒ€ë¡œ ì´ì–´ ë°›ì•„ì„œ ë”°ë¥¸ë‹¤ëŠ” ëœ»ì´ë‹¤.    * ë‹¤ë¥¸ ê´€ì ìœ¼ë¡œ ë³´ë©´ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì˜ ë²”ìœ„ê°€ ë‚´ë¶€ íŠ¸ëœì­ì…˜ê¹Œì§€ ë„“ì–´ì§„ë‹¤ëŠ” ëœ»ì´ë‹¤.    * ì™¸ë¶€ì—ì„œ ì‹œì‘ëœ ë¬¼ë¦¬ì ì¸ íŠ¸ëœì­ì…˜ì˜ ë²”ìœ„ê°€ ë‚´ë¶€ íŠ¸ëœì­ì…˜ê¹Œì§€ ë„“ì–´ì§„ë‹¤ëŠ” ëœ»ì´ë‹¤.    * ì •ë¦¬í•˜ë©´ **ì™¸ë¶€ íŠ¸ëœì­ì…˜ê³¼ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ í•˜ë‚˜ì˜ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì´ëŠ”** ê²ƒì´ë‹¤.* ë‚´ë¶€ íŠ¸ëœì­ì…˜ì€ ì´ë¯¸ ì§„í–‰ì¤‘ì¸ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•œë‹¤. \  ì´ ê²½ìš° ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ ì•„ë‹ˆë‹¤. ( `isNewTransaction=false` ).* ì˜ˆì œì—ì„œëŠ” ë‘˜ë‹¤ ì„±ê³µì ìœ¼ë¡œ ì»¤ë°‹í–ˆë‹¤.ì´ ì˜ˆì œì—ì„œëŠ” ì™¸ë¶€ íŠ¸ëœì­ì…˜ê³¼ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ í•˜ë‚˜ì˜ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì¸ë‹¤ê³  ì„¤ëª…í–ˆë‹¤.\ê·¸ëŸ°ë° ì½”ë“œë¥¼ ì˜ ë³´ë©´ ì»¤ë°‹ì„ ë‘ ë²ˆ í˜¸ì¶œí–ˆë‹¤. \íŠ¸ëœì­ì…˜ì„ ìƒê°í•´ë³´ë©´ í•˜ë‚˜ì˜ ì»¤ë„¥ì…˜ì— ì»¤ë°‹ì€ í•œë²ˆë§Œ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.\ì»¤ë°‹ì´ë‚˜ ë¡¤ë°±ì„ í•˜ë©´ í•´ë‹¹ íŠ¸ëœì­ì…˜ì€ ëë‚˜ë²„ë¦°ë‹¤.```javatxManager.commit(inner);txManager.commit(outer);```<br/><br/>## âš¡ï¸ ì‹¤í–‰ ê²°ê³¼ - inner_commit()```c.b.tx.propagation.BasicTxTest           : ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Creating new transaction with name [null]: PROPAGATION_REQUIRED,ISOLATION_DEFAULTo.s.j.d.DataSourceTransactionManager     : Acquired Connection [HikariProxyConnection@161573617 wrapping conn0: url=jdbc:h2:mem:ccdc42c0-c188-48a2-8e61-97f009c7917e user=SA] for JDBC transactiono.s.j.d.DataSourceTransactionManager     : Switching JDBC Connection [HikariProxyConnection@161573617 wrapping conn0: url=jdbc:h2:mem:ccdc42c0-c188-48a2-8e61-97f009c7917e user=SA] to manual commitc.b.tx.propagation.BasicTxTest           : outer.isNewTransaction()=truec.b.tx.propagation.BasicTxTest           : ë‚´ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Participating in existing transactionc.b.tx.propagation.BasicTxTest           : inner.isNewTransaction()=falsec.b.tx.propagation.BasicTxTest           : ë‚´ë¶€ íŠ¸ëœì­ì…˜ ì»¤ë°‹c.b.tx.propagation.BasicTxTest           : ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì»¤ë°‹o.s.j.d.DataSourceTransactionManager     : Initiating transaction commito.s.j.d.DataSourceTransactionManager     : Committing JDBC transaction on Connection [HikariProxyConnection@161573617 wrapping conn0: url=jdbc:h2:mem:ccdc42c0-c188-48a2-8e61-97f009c7917e user=SA]o.s.j.d.DataSourceTransactionManager     : Releasing JDBC Connection [HikariProxyConnection@161573617 wrapping conn0: url=jdbc:h2:mem:ccdc42c0-c188-48a2-8e61-97f009c7917e user=SA] after transaction```* ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•  ë•Œ `Participating in existing transaction` ì´ë¼ëŠ” ë©”ì‹œì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.     ì´ ë©”ì‹œì§€ëŠ” **ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ ê¸°ì¡´ì— ì¡´ì¬í•˜ëŠ” ì™¸ë¶€ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•œë‹¤**ëŠ” ëœ»ì´ë‹¤.* ì‹¤í–‰ ê²°ê³¼ë¥¼ ë³´ë©´ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê±°ë‚˜ ì»¤ë°‹í•  ë•ŒëŠ”    **DB ì»¤ë„¥ì…˜ì„ í†µí•œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì‹œì‘** ( `manual commit` )í•˜ê³ ,\  DB ì»¤ë„¥ì…˜ì„ í†µí•´ ì»¤ë°‹ í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. \  **ê·¸ëŸ°ë° ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê±°ë‚˜ ì»¤ë°‹í•  ë•ŒëŠ” DB ì»¤ë„¥ì…˜ì„ í†µí•´ ì»¤ë°‹í•˜ëŠ” ë¡œê·¸ë¥¼ ì „í˜€ í™•ì¸í•  ìˆ˜ ì—†ë‹¤.*** ì •ë¦¬í•˜ë©´ **ì™¸ë¶€ íŠ¸ëœì­ì…˜ë§Œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³ , ì»¤ë°‹í•œë‹¤.*** ë§Œì•½ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ ì‹¤ì œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ë©´ íŠ¸ëœì­ì…˜ì´ ëë‚˜ë²„ë¦¬ê¸° ë•Œë¬¸ì—, \  íŠ¸ëœì­ì…˜ì„ ì²˜ìŒ ì‹œì‘í•œ ì™¸ë¶€ íŠ¸ëœì­ì…˜ê¹Œì§€ ì´ì–´ê°ˆ ìˆ˜ ì—†ë‹¤. \  ë”°ë¼ì„œ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì€ DB ì»¤ë„¥ì…˜ì„ í†µí•œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ë©´ ì•ˆëœë‹¤.* ìŠ¤í”„ë§ì€ ì´ë ‡ê²Œ ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì´ í•¨ê»˜ ì‚¬ìš©ë˜ëŠ” ê²½ìš°, \  ì²˜ìŒ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì´ ì‹¤ì œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•˜ë„ë¡ í•œë‹¤. \  ì´ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜ ì¤‘ë³µ ì»¤ë°‹ ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤.![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/a340376d-79c7-40b8-b976-9686c42488dd)íŠ¸ëœì­ì…˜ ì „íŒŒê°€ ì‹¤ì œ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ê·¸ë¦¼ìœ¼ë¡œ ì•Œì•„ë³´ì.![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/a9033400-bfda-4841-a2b3-97ad9b872c0c)### ğŸ”‹ ìš”ì²­ íë¦„ - ì™¸ë¶€ íŠ¸ëœì­ì…˜1. `txManager.getTransaction()` ë¥¼ í˜¸ì¶œí•´ì„œ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤.2. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” ë°ì´í„°ì†ŒìŠ¤ë¥¼ í†µí•´ ì»¤ë„¥ì…˜ì„ ìƒì„±í•œë‹¤.3. ìƒì„±í•œ ì»¤ë„¥ì…˜ì„ ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œ( `setAutoCommit(false)` )ë¡œ ì„¤ì •í•œë‹¤. - **ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ ì‹œì‘**4. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì— ì»¤ë„¥ì…˜ì„ ë³´ê´€í•œë‹¤.5. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” íŠ¸ëœì­ì…˜ì„ ìƒì„±í•œ ê²°ê³¼ë¥¼ `TransactionStatus` ì— ë‹´ì•„ì„œ ë°˜í™˜í•˜ëŠ”ë°, \   ì—¬ê¸°ì— ì‹ ê·œ íŠ¸ëœì­ì…˜ì˜ ì—¬ë¶€ê°€ ë‹´ê²¨ ìˆë‹¤. `isNewTransaction` ë¥¼ í†µí•´ ì‹ ê·œ íŠ¸ëœì­ì…˜ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. \   íŠ¸ëœì­ì…˜ì„ ì²˜ìŒ ì‹œì‘í–ˆìœ¼ë¯€ë¡œ ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ë‹¤.( `true` )7. ë¡œì§1ì´ ì‚¬ìš©ë˜ê³ , ì»¤ë„¥ì…˜ì´ í•„ìš”í•œ ê²½ìš° `íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €`ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜ì´ ì ìš©ëœ ì»¤ë„¥ì…˜ì„ íšë“í•´ì„œ ì‚¬ìš©í•œë‹¤.<br/>### ğŸ”‹ ìš”ì²­ íë¦„ - ë‚´ë¶€ íŠ¸ëœì­ì…˜7. `txManager.getTransaction()` ë¥¼ í˜¸ì¶œí•´ì„œ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤.8. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ë¥¼ í†µí•´ì„œ ê¸°ì¡´ íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.9. ê¸°ì¡´ íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•˜ë¯€ë¡œ ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•œë‹¤. \   ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•œë‹¤ëŠ” ëœ»ì€ ì‚¬ì‹¤ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ëœ»ì´ë‹¤.   ì´ë¯¸ ê¸°ì¡´ íŠ¸ëœì­ì…˜ì¸ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì—ì„œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í–ˆë‹¤.\   ê·¸ë¦¬ê³  ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ëœ ì»¤ë„¥ì…˜ì„ íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì— ë‹´ì•„ë‘ì—ˆë‹¤.\   ë”°ë¼ì„œ ì´ë¯¸ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ì§„í–‰ì¤‘ì´ë¯€ë¡œ ê·¸ëƒ¥ ë‘ë©´ ì´í›„ ë¡œì§ì´ \   ê¸°ì¡´ì— ì‹œì‘ëœ íŠ¸ëœì­ì…˜ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì‚¬ìš©í•˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.\   ì´í›„ ë¡œì§ì€ ìì—°ìŠ¤ëŸ½ê²Œ íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì— ë³´ê´€ëœ ê¸°ì¡´ ì»¤ë„¥ì…˜ì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.11. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” íŠ¸ëœì­ì…˜ì„ ìƒì„±í•œ ê²°ê³¼ë¥¼ `TransactionStatus` ì— ë‹´ì•„ì„œ ë°˜í™˜í•˜ëŠ”ë°, \    ì—¬ê¸°ì—ì„œ `isNewTransaction` ë¥¼ í†µí•´ ì‹ ê·œ íŠ¸ëœì­ì…˜ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. \    ì—¬ê¸°ì„œëŠ” ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í–ˆê¸° ë•Œë¬¸ì— ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ ì•„ë‹ˆë‹¤. ( `false` )13. ë¡œì§2ê°€ ì‚¬ìš©ë˜ê³ , ì»¤ë„¥ì…˜ì´ í•„ìš”í•œ ê²½ìš° íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ë¥¼ í†µí•´ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì´ ë³´ê´€í•œ ì»¤ë„¥ì…˜ì„ íšë“í•´ì„œ ì‚¬ìš©í•œë‹¤.<br/>![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/16e17b2c-2487-48c9-9d22-88ae8dd7dde5)### ğŸ”‹ ì‘ë‹µ íë¦„ - ë‚´ë¶€ íŠ¸ëœì­ì…˜12. ë¡œì§2ê°€ ëë‚˜ê³  íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.13. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” ì»¤ë°‹ ì‹œì ì— ì‹ ê·œ íŠ¸ëœì­ì…˜ ì—¬ë¶€ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•œë‹¤. \    ì´ ê²½ìš° ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì‹¤ì œ ì»¤ë°‹ì„ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ ë¶€ë¶„ì´ ì¤‘ìš”í•œë°, \    ì‹¤ì œ ì»¤ë„¥ì…˜ì— ì»¤ë°‹ì´ë‚˜ ë¡¤ë°±ì„ í˜¸ì¶œí•˜ë©´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ëë‚˜ë²„ë¦°ë‹¤. \    ì•„ì§ íŠ¸ëœì­ì…˜ì´ ëë‚œ ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì‹¤ì œ ì»¤ë°‹ì„ í˜¸ì¶œí•˜ë©´ ì•ˆëœë‹¤. \    ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì€ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•  ë•Œ ê¹Œì§€ ì´ì–´ì ¸ì•¼í•œë‹¤.<br/>### ğŸ”‹ ì‘ë‹µ íë¦„ - ì™¸ë¶€ íŠ¸ëœì­ì…˜14. ë¡œì§1ì´ ëë‚˜ê³  íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.15. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” ì»¤ë°‹ ì‹œì ì— ì‹ ê·œ íŠ¸ëœì­ì…˜ ì—¬ë¶€ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•œë‹¤. \    ì™¸ë¶€ íŠ¸ëœì­ì…˜ì€ ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ë‹¤. ë”°ë¼ì„œ DB ì»¤ë„¥ì…˜ì— ì‹¤ì œ ì»¤ë°‹ì„ í˜¸ì¶œí•œë‹¤.17. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ì— ì»¤ë°‹í•˜ëŠ” ê²ƒì´ ë…¼ë¦¬ì ì¸ ì»¤ë°‹ì´ë¼ë©´, ì‹¤ì œ ì»¤ë„¥ì…˜ì— ì»¤ë°‹í•˜ëŠ” ê²ƒì„ \    ë¬¼ë¦¬ ì»¤ë°‹ì´ë¼ í•  ìˆ˜ ìˆë‹¤. ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ì»¤ë°‹ì´ ë°˜ì˜ë˜ê³ , ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ë„ ëë‚œë‹¤.<br/>## âš¡ï¸ í•µì‹¬ ì •ë¦¬> ì—¬ê¸°ì„œ í•µì‹¬ì€ **íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ì— ì»¤ë°‹ì„ í˜¸ì¶œí•œë‹¤ê³ í•´ì„œ í•­ìƒ ì‹¤ì œ ì»¤ë„¥ì…˜ì— ë¬¼ë¦¬ ì»¤ë°‹ì´ ë°œìƒí•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤ëŠ” ì ì´ë‹¤.**- ì‹ ê·œ íŠ¸ëœì­ì…˜ì¸ ê²½ìš°ì—ë§Œ ì‹¤ì œ ì»¤ë„¥ì…˜ì„ ì‚¬ìš©í•´ì„œ ë¬¼ë¦¬ ì»¤ë°‹ê³¼ ë¡¤ë°±ì„ ìˆ˜í–‰í•œë‹¤.- ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ ì•„ë‹ˆë©´ ì‹¤ì œ ë¬¼ë¦¬ ì»¤ë„¥ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.ì´ë ‡ê²Œ íŠ¸ëœì­ì…˜ì´ ë‚´ë¶€ì—ì„œ ì¶”ê°€ë¡œ ì‚¬ìš©ë˜ë©´ íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ì— ì»¤ë°‹í•˜ëŠ” ê²ƒì´ í•­ìƒ ë¬¼ë¦¬ ì»¤ë°‹ìœ¼ë¡œ ì´ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤.  ê·¸ë˜ì„œ ì´ ê²½ìš° ë…¼ë¦¬ íŠ¸ëœì­ì…˜ê³¼ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ë‚˜ëˆ„ê²Œ ëœë‹¤. ë˜ëŠ” ì™¸ë¶€ íŠ¸ëœì­ì…˜ê³¼ ë‚´ë¶€ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì„¤ëª…í•˜ê¸°ë„ í•œë‹¤.> **íŠ¸ëœì­ì…˜ì´ ë‚´ë¶€ì—ì„œ ì¶”ê°€ë¡œ ì‚¬ìš©ë˜ë©´, íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•˜ê³ , ëª¨ë“  ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë˜ë©´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ëœë‹¤ê³  ì´í•´í•˜ë©´ ëœë‹¤.**<br/><br/><br/># ğŸ’¡ íŠ¸ëœì­ì…˜ ì „íŒŒ - ì™¸ë¶€ ë¡¤ë°±![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/4bfbcba3-dfa6-4f50-b4df-cbe7072f5405)> **ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì´ í•˜ë‚˜ë¼ë„ ë¡¤ë°±ë˜ë©´ ì „ì²´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì€ ë¡¤ë°±ëœë‹¤.**ë”°ë¼ì„œ ì´ ê²½ìš° ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹í–ˆì–´ë„, ë‚´ë¶€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì €ì¥í•œ ë°ì´í„°ë„ ëª¨ë‘ í•¨ê»˜ ë¡¤ë°±ëœë‹¤.<br/>## âš¡ï¸ outer_rollback() - BasicTxTest ì¶”ê°€```java@Testvoid outer_rollback() {   log.info("ì™¸ë¶€ íŠ¸ëœì ì…˜ ì‹œì‘");   TransactionStatus outer = txManager.getTransaction(new DefaultTransactionAttribute());   log.info("ë‚´ë¶€ íŠ¸ëœì ì…˜ ì‹œì‘");   TransactionStatus inner = txManager.getTransaction(new DefaultTransactionAttribute());   log.info("ë‚´ë¶€ íŠ¸ëœì ì…˜ ì»¤ë°‹");   txManager.commit(inner);   log.info("ì™¸ë¶€ íŠ¸ëœì ì…˜ ë¡¤ë°±");   txManager.rollback(outer);}```<br/>## âš¡ï¸ ì‹¤í–‰ ê²°ê³¼ - outer_rollback()```c.b.tx.propagation.BasicTxTest           : ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Creating new transaction with name [null]: PROPAGATION_REQUIRED,ISOLATION_DEFAULTo.s.j.d.DataSourceTransactionManager     : Acquired Connection [HikariProxyConnection@1756618311 wrapping conn0: url=jdbc:h2:mem:e49ee980-9e87-4336-982c-d427d6f04b74 user=SA] for JDBC transactiono.s.j.d.DataSourceTransactionManager     : Switching JDBC Connection [HikariProxyConnection@1756618311 wrapping conn0: url=jdbc:h2:mem:e49ee980-9e87-4336-982c-d427d6f04b74 user=SA] to manual commitc.b.tx.propagation.BasicTxTest           : ë‚´ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Participating in existing transactionc.b.tx.propagation.BasicTxTest           : ë‚´ë¶€ íŠ¸ëœì­ì…˜ ì»¤ë°‹c.b.tx.propagation.BasicTxTest           : ì™¸ë¶€ íŠ¸ëœì­ì…˜ ë¡¤ë°±o.s.j.d.DataSourceTransactionManager     : Initiating transaction rollbacko.s.j.d.DataSourceTransactionManager     : Rolling back JDBC transaction on Connection [HikariProxyConnection@1756618311 wrapping conn0: url=jdbc:h2:mem:e49ee980-9e87-4336-982c-d427d6f04b74 user=SA]o.s.j.d.DataSourceTransactionManager     : Releasing JDBC Connection [HikariProxyConnection@1756618311 wrapping conn0: url=jdbc:h2:mem:e49ee980-9e87-4336-982c-d427d6f04b74 user=SA] after transaction```* ì™¸ë¶€ íŠ¸ëœì­ì…˜ì´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  ë¡¤ë°±í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.* ë‚´ë¶€ íŠ¸ëœì­ì…˜ì€ ì•ì„œ ë°°ìš´ëŒ€ë¡œ ì§ì ‘ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì— ê´€ì—¬í•˜ì§€ ì•ŠëŠ”ë‹¤.* ê²°ê³¼ì ìœ¼ë¡œ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì—ì„œ ì‹œì‘í•œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì˜ ë²”ìœ„ê°€ ë‚´ë¶€ íŠ¸ëœì­ì…˜ê¹Œì§€ ì‚¬ìš©ëœë‹¤.\  **ì´í›„ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë˜ë©´ì„œ ì „ì²´ ë‚´ìš©ì€ ëª¨ë‘ ë¡¤ë°±ëœë‹¤.**<br/><br/>## âš¡ï¸ ì‘ë‹µ íë¦„![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/801714b4-e28d-4536-be87-cd918cee4155)<br/>### ğŸ”‹ ì‘ë‹µ íë¦„ - ë‚´ë¶€ íŠ¸ëœì­ì…˜1. ë¡œì§2ê°€ ëë‚˜ê³  íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.2. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” ì»¤ë°‹ ì‹œì ì— ì‹ ê·œ íŠ¸ëœì­ì…˜ ì—¬ë¶€ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•œë‹¤. \   ì´ ê²½ìš° ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì‹¤ì œ ì»¤ë°‹ì„ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ ë¶€ë¶„ì´ ì¤‘ìš”í•œë°,\   ì‹¤ì œ ì»¤ë„¥ì…˜ì— ì»¤ë°‹ì´ë‚˜ ë¡¤ë°±ì„ í˜¸ì¶œí•˜ë©´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ëë‚˜ë²„ë¦°ë‹¤. \   ì•„ì§ íŠ¸ëœì­ì…˜ì´ ëë‚œ ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì‹¤ì œ ì»¤ë°‹ì„ í˜¸ì¶œí•˜ë©´ ì•ˆëœë‹¤. \   ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì€ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•  ë•Œ ê¹Œì§€ ì´ì–´ì ¸ì•¼í•œë‹¤.<br/>### ğŸ”‹ ì‘ë‹µ íë¦„ - ì™¸ë¶€ íŠ¸ëœì­ì…˜3. ë¡œì§1ì´ ëë‚˜ê³  íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•œë‹¤.4. `íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €`ëŠ” **ë¡¤ë°± ì‹œì ì— ì‹ ê·œ íŠ¸ëœì­ì…˜ ì—¬ë¶€ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•œë‹¤.** \   **ì™¸ë¶€ íŠ¸ëœì­ì…˜ì€ ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ë‹¤. ë”°ë¼ì„œ DB ì»¤ë„¥ì…˜ì— ì‹¤ì œ ë¡¤ë°±ì„ í˜¸ì¶œí•œë‹¤.**6. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ì— ë¡¤ë°±í•˜ëŠ” ê²ƒì´ ë…¼ë¦¬ì ì¸ ë¡¤ë°±ì´ë¼ë©´, ì‹¤ì œ ì»¤ë„¥ì…˜ì— ë¡¤ë°±í•˜ëŠ” ê²ƒì„ \   ë¬¼ë¦¬ ë¡¤ë°±ì´ë¼ í•  ìˆ˜ ìˆë‹¤. ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ë¡¤ë°±ì´ ë°˜ì˜ë˜ê³ , ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ë„ ëë‚œë‹¤.<br/><br/><br/># ğŸ’¡ íŠ¸ëœì­ì…˜ ì „íŒŒ - ë‚´ë¶€ ë¡¤ë°±![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/51b1f943-755a-4189-953d-a88e331bea15)<br/>## âš¡ï¸ inner_rollback() - BasicTxTest ì¶”ê°€```java @Testvoid inner_rollback() {    log.info("ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘");    TransactionStatus outer = txManager.getTransaction(new DefaultTransactionAttribute());    log.info("ë‚´ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘");    TransactionStatus inner = txManager.getTransaction(new DefaultTransactionAttribute());    log.info("ë‚´ë¶€ íŠ¸ëœì­ì…˜ ë¡¤ë°±");    txManager.rollback(inner);    log.info("ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì»¤ë°‹");    assertThatThrownBy(() -> txManager.commit(outer))        .isInstanceOf(UnexpectedRollbackException.class);}```## âš¡ï¸ ì‹¤í–‰ ê²°ê³¼ - inner_rollback```c.b.tx.propagation.BasicTxTest           : ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Creating new transaction with name [null]: PROPAGATION_REQUIRED,ISOLATION_DEFAULTo.s.j.d.DataSourceTransactionManager     : Acquired Connection [HikariProxyConnection@511033073 wrapping conn0: url=jdbc:h2:mem:169d230c-f520-4846-ac45-11dad4ff70f3 user=SA] for JDBC transactiono.s.j.d.DataSourceTransactionManager     : Switching JDBC Connection [HikariProxyConnection@511033073 wrapping conn0: url=jdbc:h2:mem:169d230c-f520-4846-ac45-11dad4ff70f3 user=SA] to manual commitc.b.tx.propagation.BasicTxTest           : ë‚´ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘o.s.j.d.DataSourceTransactionManager     : Participating in existing transactionc.b.tx.propagation.BasicTxTest           : ë‚´ë¶€ íŠ¸ëœì­ì…˜ ë¡¤ë°±o.s.j.d.DataSourceTransactionManager     : Participating transaction failed - marking existing transaction as rollback-onlyo.s.j.d.DataSourceTransactionManager     : Setting JDBC transaction [HikariProxyConnection@511033073 wrapping conn0: url=jdbc:h2:mem:169d230c-f520-4846-ac45-11dad4ff70f3 user=SA] rollback-onlyc.b.tx.propagation.BasicTxTest           : ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì»¤ë°‹o.s.j.d.DataSourceTransactionManager     : Global transaction is marked as rollback-only but transactional code requested commito.s.j.d.DataSourceTransactionManager     : Initiating transaction rollbacko.s.j.d.DataSourceTransactionManager     : Rolling back JDBC transaction on Connection [HikariProxyConnection@511033073 wrapping conn0: url=jdbc:h2:mem:169d230c-f520-4846-ac45-11dad4ff70f3 user=SA]o.s.j.d.DataSourceTransactionManager     : Releasing JDBC Connection [HikariProxyConnection@511033073 wrapping conn0: url=jdbc:h2:mem:169d230c-f520-4846-ac45-11dad4ff70f3 user=SA] after transaction```* ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘    * ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤.* ë‚´ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘    * `Participating in existing transaction`    * ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•œë‹¤.* ë‚´ë¶€ íŠ¸ëœì­ì…˜ ë¡¤ë°±    * `Participating transaction failed - marking existing transaction as rollback-only`    * ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•˜ë©´ ì‹¤ì œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì€ ë¡¤ë°±í•˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹ ì— **ê¸°ì¡´ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°± ì „ìš©ìœ¼ë¡œ í‘œì‹œí•œë‹¤.*** ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì»¤ë°‹    * ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.    * `Global transaction is marked as rollback-only but transactional code requested commit`    * ì»¤ë°‹ì„ í˜¸ì¶œí–ˆì§€ë§Œ, ì „ì²´ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°± ì „ìš©ìœ¼ë¡œ í‘œì‹œë˜ì–´ ìˆë‹¤. ë”°ë¼ì„œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•œë‹¤.![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/96b36863-a7ca-475d-8a9d-262bea91e6d0)<br/><br/>## âš¡ï¸ì‘ë‹µ íë¦„![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/6ed8671e-bf6a-4834-8b97-900b8b599f03)### ğŸ”‹ ì‘ë‹µ íë¦„ - ë‚´ë¶€ íŠ¸ëœì­ì…˜1. ë¡œì§2ê°€ ëë‚˜ê³  íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•œë‹¤. \   (ë¡œì§2ì— ë¬¸ì œê°€ ìˆì–´ì„œ ë¡¤ë°±í•œë‹¤ê³  ê°€ì •í•œë‹¤.)3. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” ë¡¤ë°± ì‹œì ì— ì‹ ê·œ íŠ¸ëœì­ì…˜ ì—¬ë¶€ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•œë‹¤. \   ì´ ê²½ìš° ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì‹¤ì œ ë¡¤ë°±ì„ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤. \   ì´ ë¶€ë¶„ì´ ì¤‘ìš”í•œë°, **ì‹¤ì œ ì»¤ë„¥ì…˜ì— ì»¤ë°‹ì´ë‚˜ ë¡¤ë°±ì„ í˜¸ì¶œí•˜ë©´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ëë‚˜ë²„ë¦°ë‹¤.\   ì•„ì§ íŠ¸ëœì­ì…˜ì´ ëë‚œ ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì‹¤ì œ ë¡¤ë°±ì„ í˜¸ì¶œí•˜ë©´ ì•ˆëœë‹¤.** \   ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì€ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•  ë•Œ ê¹Œì§€ ì´ì–´ì ¸ì•¼í•œë‹¤.5. ë‚´ë¶€ íŠ¸ëœì­ì…˜ì€ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•˜ì§€ ì•ŠëŠ” ëŒ€ì‹ ì— \   **íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €(TransactionSynchronizationManager)** ì— `rollbackOnly=true` ë¼ëŠ” í‘œì‹œë¥¼ í•´ë‘”ë‹¤.   <br/>### ğŸ”‹ ì‘ë‹µ íë¦„ - ì™¸ë¶€ íŠ¸ëœì­ì…˜4. ë¡œì§1ì´ ëë‚˜ê³  íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.5. `íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €`ëŠ” **ì»¤ë°‹ ì‹œì ì— ì‹ ê·œ íŠ¸ëœì­ì…˜ ì—¬ë¶€ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•œë‹¤.** \   ì™¸ë¶€ íŠ¸ëœì­ì…˜ì€ ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ë‹¤. ë”°ë¼ì„œ DB ì»¤ë„¥ì…˜ì— ì‹¤ì œ ì»¤ë°‹ì„ í˜¸ì¶œí•´ì•¼ í•œë‹¤.\   ì´ë•Œ ë¨¼ì € íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì— ë¡¤ë°± ì „ìš©( `rollbackOnly=true` ) í‘œì‹œê°€ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.     ë¡¤ë°± ì „ìš© í‘œì‹œê°€ ìˆìœ¼ë©´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë¡¤ë°±í•œë‹¤.7. ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ë¡¤ë°±ì´ ë°˜ì˜ë˜ê³ , ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ë„ ëë‚œë‹¤.8. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ì— ì»¤ë°‹ì„ í˜¸ì¶œí•œ ê°œë°œì ì…ì¥ì—ì„œëŠ” ë¶„ëª… ì»¤ë°‹ì„ ê¸°ëŒ€í–ˆëŠ”ë°,   ë¡¤ë°± ì „ìš© í‘œì‹œë¡œ ì¸í•´ ì‹¤ì œë¡œëŠ” ë¡¤ë°±ì´ ë˜ì–´ë²„ë ¸ë‹¤.   - ì´ê²ƒì€ ì¡°ìš©íˆ ë„˜ì–´ê°ˆ ìˆ˜ ìˆëŠ” ë¬¸ì œê°€ ì•„ë‹ˆë‹¤.    ì‹œìŠ¤í…œ ì…ì¥ì—ì„œëŠ” ì»¤ë°‹ì„ í˜¸ì¶œí–ˆì§€ë§Œ ë¡¤ë°±ì´ ë˜ì—ˆë‹¤ëŠ” ê²ƒì€ ë¶„ëª…í•˜ê²Œ ì•Œë ¤ì£¼ì–´ì•¼ í•œë‹¤.\  ì˜ˆë¥¼ ë“¤ì–´ì„œ ê³ ê°ì€ ì£¼ë¬¸ì´ ì„±ê³µí–ˆë‹¤ê³  ìƒê°í–ˆëŠ”ë°, ì‹¤ì œë¡œëŠ” ë¡¤ë°±ì´ ë˜ì–´ì„œ ì£¼ë¬¸ì´ ìƒì„±ë˜ì§€ ì•Šì€ ê²ƒì´ë‹¤. - ìŠ¤í”„ë§ì€ ì´ ê²½ìš° `UnexpectedRollbackException` `ëŸ°íƒ€ì„ ì˜ˆì™¸`ë¥¼ ë˜ì§„ë‹¤. \   ê·¸ë˜ì„œ ì»¤ë°‹ì„ ì‹œë„í–ˆì§€ë§Œ, ê¸°ëŒ€í•˜ì§€ ì•Šì€ ë¡¤ë°±ì´ ë°œìƒí–ˆë‹¤ëŠ” ê²ƒì„ ëª…í™•í•˜ê²Œ ì•Œë ¤ì¤€ë‹¤<br/><br/>## âš¡ï¸ ì •ë¦¬- **ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì´ í•˜ë‚˜ë¼ë„ ë¡¤ë°±ë˜ë©´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì€ ë¡¤ë°±ëœë‹¤.**- ë‚´ë¶€ ë…¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë˜ë©´ `ë¡¤ë°± ì „ìš© ë§ˆí¬(rollback-only=true)`ë¥¼ í‘œì‹œí•œë‹¤.- ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•  ë•Œ ë¡¤ë°± ì „ìš© ë§ˆí¬ë¥¼ í™•ì¸í•œë‹¤. - **ë¡¤ë°± ì „ìš© ë§ˆí¬ê°€ í‘œì‹œë˜ì–´ ìˆìœ¼ë©´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•˜ê³ , `UnexpectedRollbackException` ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤.**> ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì—ì„œ ì¤‘ìš”í•œ ê¸°ë³¸ ì›ì¹™ì€ ëª¨í˜¸í•¨ì„ ì œê±°í•˜ëŠ” ê²ƒì´ë‹¤. \> ê°œë°œì€ ëª…í™•í•´ì•¼ í•œë‹¤. ì´ë ‡ê²Œ ì»¤ë°‹ì„ í˜¸ì¶œí–ˆëŠ”ë°, ë‚´ë¶€ì—ì„œ ë¡¤ë°±ì´ ë°œìƒí•œ ê²½ìš° \> ëª¨í˜¸í•˜ê²Œ ë‘ë©´ ì•„ì£¼ ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤. \> ì´ë ‡ê²Œ ê¸°ëŒ€í•œ ê²°ê³¼ê°€ ë‹¤ë¥¸ ê²½ìš° ì˜ˆì™¸ë¥¼ ë°œìƒì‹œì¼œì„œ ëª…í™•í•˜ê²Œ ë¬¸ì œë¥¼ ì•Œë ¤ì£¼ëŠ” ê²ƒì´ ì¢‹ì€ ì„¤ê³„ì´ë‹¤.<br/><br/><br/>## ìŠ¤í”„ë§ íŠ¸ëœì­ì…˜ ì „íŒŒ7 - REQUIRES_NEWì´ë²ˆì—ëŠ” ì™¸ë¶€ íŠ¸ëœì­ì…˜ê³¼ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì™„ì „íˆ ë¶„ë¦¬í•´ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì.\ì™¸ë¶€ íŠ¸ëœì­ì…˜ê³¼ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì™„ì „íˆ ë¶„ë¦¬í•´ì„œ \ê°ê° ë³„ë„ì˜ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.\ê·¸ë˜ì„œ ì»¤ë°‹ê³¼ ë¡¤ë°±ë„ ê°ê° ë³„ë„ë¡œ ì´ë£¨ì–´ì§€ê²Œ ëœë‹¤.\ì´ ë°©ë²•ì€ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì— ë¬¸ì œê°€ ë°œìƒí•´ì„œ ë¡¤ë°±í•´ë„, \ì™¸ë¶€ íŠ¸ëœì­ì…˜ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤. ë°˜ëŒ€ë¡œ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì— ë¬¸ì œê°€ ë°œìƒí•´ë„ \ë‚´ë¶€ íŠ¸ëœì­ì…˜ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ëŠ” êµ¬ì²´ì ì¸ ì˜ˆëŠ” ì´í›„ì— ì•Œì•„ë³´ê³  ì§€ê¸ˆì€ ì‘ë™ ì›ë¦¬ë¥¼ ì´í•´í•´ë³´ì.<br/><br/>### REQUIRES_NEW![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/bbab7ab2-e83f-434a-8598-0eeb601cc673)ì´ë ‡ê²Œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ë¶„ë¦¬í•˜ë ¤ë©´ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•  ë•Œ \REQUIRES_NEW ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.ì™¸ë¶€ íŠ¸ëœì­ì…˜ê³¼ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ ê°ê° ë³„ë„ì˜ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ê°€ì§„ë‹¤.\ë³„ë„ì˜ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ê°€ì§„ë‹¤ëŠ” ëœ»ì€ DB ì»¤ë„¥ì…˜ì„ ë”°ë¡œ ì‚¬ìš©í•œë‹¤ëŠ” ëœ»ì´ë‹¤.\ì´ ê²½ìš° ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë˜ë©´ì„œ ë¡œì§ 2ê°€ ë¡¤ë°±ë˜ì–´ë„ ë¡œì§ 1ì—ì„œ \ì €ì¥í•œ ë°ì´í„°ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.ìµœì¢…ì ìœ¼ë¡œ ë¡œì§2ëŠ” ë¡¤ë°±ë˜ê³ , ë¡œì§1ì€ ì»¤ë°‹ëœë‹¤.<br/><br/>### inner_rollback_requires_new() - BasicTxTest ì¶”ê°€```java@Testvoid inner_rollback_requires_new() {   log.info("ì™¸ë¶€ íŠ¸ëœì ì…˜ ì‹œì‘");   TransactionStatus outer = txManager.getTransaction(new DefaultTransactionAttribute());   log.info("outer.isNewTransaction()={}", outer.isNewTransaction());   log.info("ë‚´ë¶€ íŠ¸ëœì ì…˜ ì‹œì‘");   DefaultTransactionAttribute definition = new DefaultTransactionAttribute();   definition.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRES_NEW);   TransactionStatus inner = txManager.getTransaction(definition);   log.info("inner.isNewTransaction()={}", inner.isNewTransaction());   log.info("ë‚´ë¶€ íŠ¸ëœì ì…˜ ë¡¤ë°±");   txManager.rollback(inner);   log.info("ì™¸ë¶€ íŠ¸ëœì ì…˜ ì»¤ë°‹");   txManager.commit(outer);}```ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•  ë•Œ ì „íŒŒ ì˜µì…˜ì¸ propagationBehavior ì— \PROPAGATION_REQUIRES_NEW ì˜µì…˜ì„ ì£¼ì—ˆë‹¤.ì´ ì „íŒŒ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•  ë•Œ \ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ìƒˆë¡œìš´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ë§Œë“¤ì–´ì„œ ì‹œì‘í•˜ê²Œ ëœë‹¤.<br/><br/>#### ì‹¤í–‰ ê²°ê³¼ - inner_rollback_requires_new()```javaì™¸ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘Creating new transaction with name [null]:PROPAGATION_REQUIRED,ISOLATION_DEFAULTAcquired Connection [HikariProxyConnection@1064414847 wrapping conn0] for JDBC transactionSwitching JDBC Connection [HikariProxyConnection@1064414847 wrapping conn0] to manual commitouter.isNewTransaction()=trueë‚´ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘Suspending current transaction, creating new transaction with name [null]Acquired Connection [HikariProxyConnection@778350106 wrapping conn1] for JDBC transactionSwitching JDBC Connection [HikariProxyConnection@778350106 wrapping conn1] to manual commitinner.isNewTransaction()=trueë‚´ë¶€ íŠ¸ëœì­ì…˜ ë¡¤ë°±Initiating transaction rollbackRolling back JDBC transaction on Connection [HikariProxyConnection@778350106 wrapping conn1]Releasing JDBC Connection [HikariProxyConnection@778350106 wrapping conn1] after transactionResuming suspended transaction after completion of inner transactionì™¸ë¶€ íŠ¸ëœì­ì…˜ ì»¤ë°‹Initiating transaction commitCommitting JDBC transaction on Connection [HikariProxyConnection@1064414847 wrapping conn0]Releasing JDBC Connection [HikariProxyConnection@1064414847 wrapping conn0] after transaction```<br/><br/>#### ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ë©´ì„œ conn0 ë¥¼ íšë“í•˜ê³  manual commit ìœ¼ë¡œ ë³€ê²½í•´ì„œ \ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤.ì™¸ë¶€ íŠ¸ëœì­ì…˜ì€ ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ë‹¤.( outer.isNewTransaction()=true )<br/><br/>#### ë‚´ë¶€ íŠ¸ëœì­ì…˜ ì‹œì‘ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ë©´ì„œ conn1 ë¥¼ íšë“í•˜ê³  manual commit ìœ¼ë¡œ \ë³€ê²½í•´ì„œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤.ë‚´ë¶€ íŠ¸ëœì­ì…˜ì€ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, \PROPAGATION_REQUIRES_NEW ì˜µì…˜ì„ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— \ì™„ì „íˆ ìƒˆë¡œìš´ ì‹ ê·œ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ìƒì„±ëœë‹¤.( inner.isNewTransaction()=true )<br/><br/>### ë‚´ë¶€ íŠ¸ëœì­ì…˜ ë¡¤ë°±ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•œë‹¤.\ë‚´ë¶€ íŠ¸ëœì­ì…˜ì€ ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ê¸° ë•Œë¬¸ì— ì‹¤ì œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•œë‹¤.\ë‚´ë¶€ íŠ¸ëœì­ì…˜ì€ conn1 ì„ ì‚¬ìš©í•˜ë¯€ë¡œ conn1 ì— ë¬¼ë¦¬ ë¡¤ë°±ì„ ìˆ˜í–‰í•œë‹¤.<br/><br/>### ì™¸ë¶€ íŠ¸ëœì­ì…˜ ì»¤ë°‹ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.\ì™¸ë¶€ íŠ¸ëœì­ì…˜ì€ ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ê¸° ë•Œë¬¸ì— ì‹¤ì œ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.\ì™¸ë¶€ íŠ¸ëœì­ì…˜ì€ conn0 ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ conn0 ì— ë¬¼ë¦¬ ì»¤ë°‹ì„ ìˆ˜í–‰í•œë‹¤.<br/><br/>### í˜„ì¬ ìƒí™©í˜„ì¬ ìƒí™©ì„ ê·¸ë¦¼ìœ¼ë¡œ í™•ì¸í•´ë³´ì.![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/0a3f67e8-c340-4e75-b0dc-635a26a339f1)<br/><br/>#### ìš”ì²­ íë¦„ - REQUIRES_NEW![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/a5243ec3-3a84-4bdb-aeae-2cedc727a9be)<br/><br/>#### ìš”ì²­ íë¦„ - ì™¸ë¶€ íŠ¸ëœì­ì…˜1. txManager.getTransaction() ë¥¼ í˜¸ì¶œí•´ì„œ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤.2. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” ë°ì´í„°ì†ŒìŠ¤ë¥¼ í†µí•´ ì»¤ë„¥ì…˜ì„ ìƒì„±í•œë‹¤.3. ìƒì„±í•œ ì»¤ë„¥ì…˜ì„ ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œ( setAutoCommit(false) )ë¡œ ì„¤ì •í•œë‹¤. - ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ ì‹œì‘4. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì— ì»¤ë„¥ì…˜ì„ ë³´ê´€í•œë‹¤.5. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” íŠ¸ëœì­ì…˜ì„ ìƒì„±í•œ ê²°ê³¼ë¥¼ TransactionStatus ì— ë‹´ì•„ì„œ ë°˜í™˜í•˜ëŠ”ë°, \   ì—¬ê¸°ì— ì‹ ê·œ íŠ¸ëœì­ì…˜ì˜ ì—¬ë¶€ê°€ ë‹´ê²¨ ìˆë‹¤. isNewTransaction ë¥¼ í†µí•´\   ì‹ ê·œ íŠ¸ëœì­ì…˜ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.\   íŠ¸ëœì­ì…˜ì„ ì²˜ìŒ ì‹œì‘í–ˆìœ¼ë¯€ë¡œ ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ë‹¤.( true )7. ë¡œì§1ì´ ì‚¬ìš©ë˜ê³ , ì»¤ë„¥ì…˜ì´ í•„ìš”í•œ ê²½ìš° íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ë¥¼ í†µí•´ \   íŠ¸ëœì­ì…˜ì´ ì ìš©ëœ ì»¤ë„¥ì…˜ì„ íšë“í•´ì„œ ì‚¬ìš©í•œë‹¤.   <br/>#### ìš”ì²­ íë¦„ - ë‚´ë¶€ íŠ¸ëœì­ì…˜7. REQUIRES_NEW ì˜µì…˜ê³¼ í•¨ê»˜ txManager.getTransaction() ë¥¼ í˜¸ì¶œí•´ì„œ \   ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤.\   íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” REQUIRES_NEW ì˜µì…˜ì„ í™•ì¸í•˜ê³ , \   ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤.9. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” ë°ì´í„°ì†ŒìŠ¤ë¥¼ í†µí•´ ì»¤ë„¥ì…˜ì„ ìƒì„±í•œë‹¤.10. ìƒì„±í•œ ì»¤ë„¥ì…˜ì„ ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œ( setAutoCommit(false) )ë¡œ ì„¤ì •í•œë‹¤. - **ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ ì‹œì‘**11. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì— ì»¤ë„¥ì…˜ì„ ë³´ê´€í•œë‹¤.\    ì´ë•Œ con1 ì€ ì ì‹œ ë³´ë¥˜ë˜ê³ , ì§€ê¸ˆë¶€í„°ëŠ” con2 ê°€ ì‚¬ìš©ëœë‹¤. \    (ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ì™„ë£Œí•  ë•Œ ê¹Œì§€ con2 ê°€ ì‚¬ìš©ëœë‹¤.)13. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” ì‹ ê·œ íŠ¸ëœì­ì…˜ì˜ ìƒì„±í•œ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤. isNewTransaction == true14. ë¡œì§2ê°€ ì‚¬ìš©ë˜ê³ , ì»¤ë„¥ì…˜ì´ í•„ìš”í•œ ê²½ìš° íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì— ìˆëŠ” \    con2 ì»¤ë„¥ì…˜ì„ íšë“í•´ì„œ ì‚¬ìš©í•œë‹¤.    <br/>### ì‘ë‹µ íë¦„ - REQUIRES_NEW![image](https://github.com/jub3907/Today-I-Learn/assets/58246682/a7c010c2-7d41-4120-9479-165bed8916b7)<br/><br/>#### ì‘ë‹µ íë¦„ - ë‚´ë¶€ íŠ¸ëœì­ì…˜1. ë¡œì§2ê°€ ëë‚˜ê³  íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•œë‹¤. \   (ë¡œì§2ì— ë¬¸ì œê°€ ìˆì–´ì„œ ë¡¤ë°±í•œë‹¤ê³  ê°€ì •í•œë‹¤.)3. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” ë¡¤ë°± ì‹œì ì— ì‹ ê·œ íŠ¸ëœì­ì…˜ ì—¬ë¶€ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•œë‹¤.\   í˜„ì¬ ë‚´ë¶€ íŠ¸ëœì­ì…˜ì€ ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ë‹¤. ë”°ë¼ì„œ ì‹¤ì œ ë¡¤ë°±ì„ í˜¸ì¶œí•œë‹¤.5. ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ con2 ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•œë‹¤.\   íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ê³ , con2 ëŠ” ì¢…ë£Œë˜ê±°ë‚˜, ì»¤ë„¥ì…˜ í’€ì— ë°˜ë‚©ëœë‹¤.\   ì´í›„ì— con1 ì˜ ë³´ë¥˜ê°€ ëë‚˜ê³ , ë‹¤ì‹œ con1 ì„ ì‚¬ìš©í•œë‹¤.   <br/>#### ì‘ë‹µ íë¦„ - ì™¸ë¶€ íŠ¸ëœì­ì…˜4. ì™¸ë¶€ íŠ¸ëœì­ì…˜ì— ì»¤ë°‹ì„ ìš”ì²­í•œë‹¤.5. ì™¸ë¶€ íŠ¸ëœì­ì…˜ì€ ì‹ ê·œ íŠ¸ëœì­ì…˜ì´ê¸° ë•Œë¬¸ì— ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.6. ì´ë•Œ rollbackOnly ì„¤ì •ì„ ì²´í¬í•œë‹¤. rollbackOnly ì„¤ì •ì´ ì—†ìœ¼ë¯€ë¡œ ì»¤ë°‹í•œë‹¤.7. ë³¸ì¸ì´ ë§Œë“  con1 ì»¤ë„¥ì…˜ì„ í†µí•´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.\   íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ê³ , con1 ì€ ì¢…ë£Œë˜ê±°ë‚˜, ì»¤ë„¥ì…˜ í’€ì— ë°˜ë‚©ëœë‹¤   <br/>#### ì •ë¦¬REQUIRES_NEW ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì´ ëª…í™•í•˜ê²Œ ë¶„ë¦¬ëœë‹¤.\REQUIRES_NEW ë¥¼ ì‚¬ìš©í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ì´ ë™ì‹œì— 2ê°œ ì‚¬ìš©ëœë‹¤ëŠ” ì ì„ ì£¼ì˜í•´ì•¼ í•œë‹¤<br/><br/>## ìŠ¤í”„ë§ íŠ¸ëœì­ì…˜ ì „íŒŒ8 - ë‹¤ì–‘í•œ ì „íŒŒ ì˜µì…˜ìŠ¤í”„ë§ì€ ë‹¤ì–‘í•œ íŠ¸ëœì­ì…˜ ì „íŒŒ ì˜µì…˜ì„ ì œê³µí•œë‹¤. \ì „íŒŒ ì˜µì…˜ì— ë³„ë„ì˜ ì„¤ì •ì„ í•˜ì§€ ì•Šìœ¼ë©´ REQUIRED ê°€ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.ì°¸ê³ ë¡œ ì‹¤ë¬´ì—ì„œëŠ” ëŒ€ë¶€ë¶„ REQUIRED ì˜µì…˜ì„ ì‚¬ìš©í•œë‹¤. \ê·¸ë¦¬ê³  ì•„ì£¼ ê°€ë” REQUIRES_NEW ì„ ì‚¬ìš©í•˜ê³ ,ë‚˜ë¨¸ì§€ëŠ” ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. \ê·¸ë˜ì„œ ë‚˜ë¨¸ì§€ ì˜µì…˜ì€ ì´ëŸ° ê²ƒì´ ìˆë‹¤ëŠ” ì •ë„ë¡œë§Œ ì•Œì•„ë‘ê³  í•„ìš”í•  ë•Œ ì°¾ì•„ë³´ì.<br/><br/>#### REQUIREDê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ ì„¤ì •ì´ë‹¤. ê¸°ì¡´ íŠ¸ëœì­ì…˜ì´ ì—†ìœ¼ë©´ ìƒì„±í•˜ê³ , ìˆìœ¼ë©´ ì°¸ì—¬í•œë‹¤.\íŠ¸ëœì­ì…˜ì´ í•„ìˆ˜ë¼ëŠ” ì˜ë¯¸ë¡œ ì´í•´í•˜ë©´ ëœë‹¤. \(í•„ìˆ˜ì´ê¸° ë•Œë¬¸ì— ì—†ìœ¼ë©´ ë§Œë“¤ê³ , ìˆìœ¼ë©´ ì°¸ì—¬í•œë‹¤.)\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ì—†ìŒ: ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•œë‹¤.\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ìˆìŒ: ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•œë‹¤.<br/><br/>#### REQUIRES_NEWí•­ìƒ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•œë‹¤.\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ì—†ìŒ: ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•œë‹¤.\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ìˆìŒ: ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•œë‹¤.<br/><br/>#### SUPPORTíŠ¸ëœì­ì…˜ì„ ì§€ì›í•œë‹¤ëŠ” ëœ»ì´ë‹¤. ê¸°ì¡´ íŠ¸ëœì­ì…˜ì´ ì—†ìœ¼ë©´, ì—†ëŠ”ëŒ€ë¡œ ì§„í–‰í•˜ê³ , ìˆìœ¼ë©´ ì°¸ì—¬í•œë‹¤.\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ì—†ìŒ: íŠ¸ëœì­ì…˜ ì—†ì´ ì§„í–‰í•œë‹¤.\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ìˆìŒ: ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•œë‹¤.<br/><br/>#### NOT_SUPPORTíŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ì—†ìŒ: íŠ¸ëœì­ì…˜ ì—†ì´ ì§„í–‰í•œë‹¤.\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ìˆìŒ: íŠ¸ëœì­ì…˜ ì—†ì´ ì§„í–‰í•œë‹¤. (ê¸°ì¡´ íŠ¸ëœì­ì…˜ì€ ë³´ë¥˜í•œë‹¤)<br/><br/>#### MANDATORYì˜ë¬´ì‚¬í•­ì´ë‹¤. íŠ¸ëœì­ì…˜ì´ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•œë‹¤. \ê¸°ì¡´ íŠ¸ëœì­ì…˜ì´ ì—†ìœ¼ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ì—†ìŒ: IllegalTransactionStateException ì˜ˆì™¸ ë°œìƒ\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ìˆìŒ: ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•œë‹¤.<br/><br/>#### NEVERíŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤. ê¸°ì¡´ íŠ¸ëœì­ì…˜ì´ ìˆìœ¼ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤. \ê¸°ì¡´ íŠ¸ëœì­ì…˜ë„ í—ˆìš©í•˜ì§€ ì•ŠëŠ” ê°•í•œ ë¶€ì •ì˜ ì˜ë¯¸ë¡œ ì´í•´í•˜ë©´ ëœë‹¤.\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ì—†ìŒ: íŠ¸ëœì­ì…˜ ì—†ì´ ì§„í–‰í•œë‹¤.\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ìˆìŒ: IllegalTransactionStateException ì˜ˆì™¸ ë°œìƒ<br/><br/>#### NESTEDê¸°ì¡´ íŠ¸ëœì­ì…˜ ì—†ìŒ: ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•œë‹¤.\ê¸°ì¡´ íŠ¸ëœì­ì…˜ ìˆìŒ: ì¤‘ì²© íŠ¸ëœì­ì…˜ì„ ë§Œë“ ë‹¤.\ì¤‘ì²© íŠ¸ëœì­ì…˜ì€ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì˜ ì˜í–¥ì„ ë°›ì§€ë§Œ, \ì¤‘ì²© íŠ¸ëœì­ì…˜ì€ ì™¸ë¶€ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.ì¤‘ì²© íŠ¸ëœì­ì…˜ì´ ë¡¤ë°± ë˜ì–´ë„ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì€ ì»¤ë°‹í•  ìˆ˜ ìˆë‹¤.\ì™¸ë¶€ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°± ë˜ë©´ ì¤‘ì²© íŠ¸ëœì­ì…˜ë„ í•¨ê»˜ ë¡¤ë°±ëœë‹¤.ì°¸ê³ ë¡œ, JDBC savepoint ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤.\DB ë“œë¼ì´ë²„ì—ì„œ í•´ë‹¹ ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸ì´ í•„ìš”í•˜ë‹¤.\ì¤‘ì²© íŠ¸ëœì­ì…˜ì€ JPAì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤<br/><br/>#### íŠ¸ëœì­ì…˜ ì „íŒŒì™€ ì˜µì…˜isolation , timeout , readOnly ëŠ” íŠ¸ëœì­ì…˜ì´ ì²˜ìŒ ì‹œì‘ë  ë•Œë§Œ ì ìš©ëœë‹¤. \íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•˜ëŠ” ê²½ìš°ì—ëŠ” ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.\ì˜ˆë¥¼ ë“¤ì–´ì„œ REQUIRED ë¥¼ í†µí•œ íŠ¸ëœì­ì…˜ ì‹œì‘, \REQUIRES_NEW ë¥¼ í†µí•œ íŠ¸ëœì­ì…˜ ì‹œì‘ ì‹œì ì—ë§Œ ì ìš©ëœë‹¤<br/><br/>